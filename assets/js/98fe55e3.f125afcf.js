"use strict";(self.webpackChunkanthology_dev_docs=self.webpackChunkanthology_dev_docs||[]).push([[4825],{15680:(e,t,n)=>{n.d(t,{xA:()=>d,yg:()=>m});var a=n(96540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=l(n),p=o,m=u["".concat(c,".").concat(p)]||u[p]||h[p]||i;return n?a.createElement(m,r(r({ref:t},d),{},{components:n})):a.createElement(m,r({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=p;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[u]="string"==typeof e?e:o,r[1]=s;for(var l=2;l<i;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},59744:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var a=n(58168),o=(n(96540),n(15680));const i={title:"Determining Account Balances for Students",id:"studentapi-accountbalance-details",sidebar_position:1,author:"Jim Burns",published:"",edited:""},r=void 0,s={unversionedId:"student/best-practices/studentapi-accountbalance-details",id:"student/best-practices/studentapi-accountbalance-details",title:"Determining Account Balances for Students",description:"One of the common use cases for integrators is to determine an account balance for a student. There are several different types of balances that may need to be retrieved. There are overall balances such as overall account balance for the student and an overall balance for a specific enrollment record for a student. There is also a balance for a subsidiary ledger for a student. And finally, there are use cases where an account balance for a specific term for a student needs to be determined. This document will cover these use cases and provide the details on how to return/calculate these balances using the Anthology data model.",source:"@site/docs/student/best-practices/DeterminingAccountBalances.md",sourceDirName:"student/best-practices",slug:"/student/best-practices/studentapi-accountbalance-details",permalink:"/docs/student/best-practices/studentapi-accountbalance-details",draft:!1,editUrl:"https://github.com/blackboard/anthologydevdocs/tree/main/docs/student/best-practices/DeterminingAccountBalances.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Determining Account Balances for Students",id:"studentapi-accountbalance-details",sidebar_position:1,author:"Jim Burns",published:"",edited:""},sidebar:"documentationSidebar",previous:{title:"Updating Account Statuses",permalink:"/docs/student/best-practices/studentapi-updateaccountstatus-details"},next:{title:"Managing Class Sections via APIs",permalink:"/docs/student/best-practices/studentapi-classsectionapi-details"}},c={},l=[{value:"Account Balance for a Student or Student Enrollment Period record",id:"account-balance-for-a-student-or-student-enrollment-period-record",level:2},{value:"Account Balance for a Subsidiary Ledger",id:"account-balance-for-a-subsidiary-ledger",level:2},{value:"Account Balance for a term",id:"account-balance-for-a-term",level:2},{value:"Balance calculation logic using ONLY the StudentAccountTransaction entity",id:"balance-calculation-logic-using-only-the-studentaccounttransaction-entity",level:3},{value:"Balance calculation logic using BOTH the StudentAccountTransaction and StudentAccountTransactionAppliedPayment entities",id:"balance-calculation-logic-using-both-the-studentaccounttransaction-and-studentaccounttransactionappliedpayment-entities",level:3},{value:"Authorization",id:"authorization",level:2},{value:"Conclusion",id:"conclusion",level:2}],d={toc:l},u="wrapper";function h(e){let{components:t,...i}=e;return(0,o.yg)(u,(0,a.A)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"One of the common use cases for integrators is to determine an account balance for a student. There are several different types of balances that may need to be retrieved. There are overall balances such as overall account balance for the student and an overall balance for a specific enrollment record for a student. There is also a balance for a subsidiary ledger for a student. And finally, there are use cases where an account balance for a specific term for a student needs to be determined. This document will cover these use cases and provide the details on how to return/calculate these balances using the Anthology data model."),(0,o.yg)("p",null,"For the use cases where an overall balance for a student, enrollment or subsidiary ledger is needed, a simple odata query can be used. If the requirement is to calculate a balance for a given term, then the logic will be more complex and potentially require multiple odata queries with additional calculations needed on the returned data."),(0,o.yg)("h2",{id:"account-balance-for-a-student-or-student-enrollment-period-record"},"Account Balance for a Student or Student Enrollment Period record"),(0,o.yg)("p",null,"The overall account balance for a student is stored on the student master record (Student entity). The property that stores this balance is ArBalance. This property is recalculated every time there is any transaction posted to the student's ledger card. This balance will reflect the overall AR balance for the student regardless of which student enrollment period each individual transaction on the ledger card is associated to. To retrieve this balance you only need to know the StudentId value for the student: ds/odata/Students?$filter=Id eq ########&$select=ArBalance where ######## is the Id of the Student record the balance is being retrieved for."),(0,o.yg)("p",null,"The overall account balance for a student enrollment period is stored on the student enrollment period record (StudentEnrollmentPeriod entity). The property that stores this is AccountReceivableBalance. The property is recalculated every time there is any transaction posted to the student's ledger card that is associated to the StudentEnrollmentPeriod record. A Student can have multiple enrollments. The AR Balance for each enrollment will be stored in this property: ds/odata/StudentEnrollmentPeriods?$filter=Id eq #######&$select=AccountReceivableBalance where ####### is the Id of the StudentEnrollmentPeriod record the balance is being retrieved for."),(0,o.yg)("h2",{id:"account-balance-for-a-subsidiary-ledger"},"Account Balance for a Subsidiary Ledger"),(0,o.yg)("p",null,"Subsidiary Ledgers is a feature in Anthology Student that allows for separate ledgers to be created that are isolated from the transactions posted to a student's main ledger card. Student Subsidiary ledgers are associated at the StudentEnrollmentPeriod entity level. The entity that stores the ledgers being tracked for students is StudentSubsidiaryAccount. If you want to see all subsidiary ledgers for a given student you can use the SubsisiaryAccount navigation property on the StudentEnrollmentPeriod entity: ds/odata/StudentEnrollmentPeriods?$expand=SubsidiaryAccount"),(0,o.yg)("p",null,"Once the subsidiary ledger you need the balance for is identified, you just need to retrieve the value in the AccountBalance property on the StudentSubsidiaryAccount record."),(0,o.yg)("h2",{id:"account-balance-for-a-term"},"Account Balance for a term"),(0,o.yg)("p",null,"Account Balances for specific terms are not persisted anywhere in the Anthology Student data model and will need to be calculated. At a high level, the calculation logic will need to isolate transactions for the specific term the balance is being calculated for and then sum the debits/credits in order to derive the balance. The logic needed for this will vary depending on how the client is utilizing the Apply Payments feature. There are configuration options that specify if payments will be auto applied to charges when posted, the effective date of the auto apply logic, details on the order of how payments are applied etc. At a high level, there are 2 key configuration data points that must be determined in order to decide the best logic to use for calculating the term balance. The first is to determine if payments are being auto applied. This is a campus specific setting. When set to auto apply, any payment or credit adjustment transaction that is posted will be automatically applied to charge transactions using the Credits Apply Order configuration. If not set to auto apply, then each payment transaction and credit adjustment transaction will have to be manually applied by the user. If this is not done, then the apply payment details will not exist for a given payment/credit adjustment transaction. Navigate to Settings - Campuses - Student Accounts to see this setting."),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"AccountBalances",src:n(92300).A,width:"1920",height:"891"})),(0,o.yg)("p",null,"The value of this setting is stored in the ApplyPaymentsMethod property on the Campus entity. To retrieve this setting value for a given campus: ds/odata/Campuses?$filter=Id eq ######&$select=ApplyPaymentMethod where ###### is the Id of the Campus the setting value is being retrieved for. Use the CampusId on the Student entity record if the scope of the balance calculation is at the Student level. Use the CampusId on the StudentEnrollmentPeriod entity record if the scope of the balance calculation is at the StudentEnrollmentPeriod level."),(0,o.yg)("p",null,"If the setting to auto apply is turned on, then a determination needs to be made as to if a payment is allowed to be applied to a different term than the term the payment transaction itself is associated to. This is configured within the Credits Apply Order option. To access, navigate to Configuration - Student Accounts - Credits Apply Order. This specific setting is set at the apply line item level meaning that it can vary between credit billing codes/fund sources."),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"AccountBalances",src:n(28711).A,width:"1920",height:"863"})),(0,o.yg)("p",null,"If the Basis is set to Payment Period, then any payments/credit adjustments posted for the specified fund source/credit adjustment billing code can only be applied to other charge transactions that are associated to the term that the given payment transaction is associated to. If a different Basis is selected, then the payment/credit adjustment transaction can be associated to charge transactions for different terms."),(0,o.yg)("p",null,'NOTE: There are some built-in rules that cannot be controlled via configuration that could cause payments to be applied to different terms even when the selected Basis is "Payment Period". This could result in an incorrect balance calculation when using ONLY the StudentAccountTransaction entity (see balance calculation logic options below) even when the configured Basis is "Payment Period". Thus it is recommended to implement the Balance calculation using BOTH StudentAccountTransaction and StudentAccountTransactionAppliedPayment entities if the setting to Auto Apply payments is set for a given campus. If the payment apply setting for a campus is "Manual/User Applied", then the best logic to use for calculating the term account balance will need to be worked out with the client. If it cannot be assumed that accurate payment apply details are stored in the StudentAccountTransactionAppliedPayment entity, then logic using ONLY the StudentAccountTransaction entity must be used.'),(0,o.yg)("h3",{id:"balance-calculation-logic-using-only-the-studentaccounttransaction-entity"},"Balance calculation logic using ONLY the StudentAccountTransaction entity"),(0,o.yg)("p",null,"The first step for calculating the term account balance will be to retrieve all rows from the StudentAccountTransactions entity for the term the balance is being calculated for. Additionally, if the scope of the balance calculation is the Student, then an additional filter on StudentId will be needed: ds/odata/StudentAccountTransactions?$filter=StudentId eq ####### and TermId eq 99999999 where ######## is the student id you are filtering on and 99999999 is the term id of the term the balance is being calculated for."),(0,o.yg)("p",null,"If the scope of the balance calculation is a specific student enrollment period, then an additional filter on StudentEnrollmentPeriodId will be needed: ds/odata/StudentAccountTransactions?$filter=StudentEnrollmentPeriodId eq ####### and TermId eq 99999999 where ######## is the student enrollment period id you are filtering on and 99999999 is the term id of the term the balance is being calculated for."),(0,o.yg)("p",null,"Using the result set from the above query, you can then calculate the account balance. Sum the TransactionAmount property for all rows where Type is equal to D or I. Then sum TransactionAmount property for all rows where Type is equal to C or P. Subtract this summed amount from the sum of all rows where Type is equal to D or I. This will be the term account balance."),(0,o.yg)("h3",{id:"balance-calculation-logic-using-both-the-studentaccounttransaction-and-studentaccounttransactionappliedpayment-entities"},"Balance calculation logic using BOTH the StudentAccountTransaction and StudentAccountTransactionAppliedPayment entities"),(0,o.yg)("p",null,"The first step for calculating the term account balance will be to retrieve all charge transactions from the StudentAccountTransaction entity for the term the balance is being calculated for. Additionally, the filter needs to include whether it is for the student or a specific student enrollment period (see above). Odata query using student as the scope would be: ds/odata/StudentAccountTransactions?$$filter=StudentId eq ######### and TermId eq 99999999 and (Type eq 'I' or Type eq 'D')."),(0,o.yg)("p",null,"Using the result set returned from the query above, sum the TransactionAmount property for all rows. This is the total amount of charges for the term. The next step is to reduce the balance by the amount of payments/credits that have been applied against each of these charges. The amount of applied payments to a given charge transaction can be determined by retrieving all rows from the StudentAccountTransactionAppliedPayment entity where AppliedToStudentAccountTransactionId equals the Id of the StudentAccountTransaction charge record being evaluated. Since multiple payments can be applied to a single charge, there may be multiple rows in the StudentAccountTransactionAppliedPayment entity that have amounts applied to the given charge transaction. Sum the AppliedAmount value for all rows returned. Perform this calculation for each charge transaction returned from the StudentAccountTransaction query above. Once the total applied amount for all charges has been calculated subtract this from the total amount of charges calculated for the term. The result is the account balance for the term."),(0,o.yg)("p",null,"NOTE: There is an AmountPaid property on the StudentAccountTransaction entity. The intent is that this property will store the amount of applied payments/credits that have been applied to the charge. This property can be used to greatly simplify the processing logic needed to calculate the term account balance. However, there have been instances in the past whereby this property has not always been correctly maintained and does not reconcile to the specific payment apply details in the StudentAccountTransactionAppliedPayment entity. This is why it is recommended to utilize the data in the apply payment entity itself as opposed to using the amount stored on this property."),(0,o.yg)("h2",{id:"authorization"},"Authorization"),(0,o.yg)("p",null,"In order to execute the OData queries needed for retrieving the data to calculate account balances, proper authorization needs to be configured. Whether using Basic Auth or OAuth with application key to authenticate, the user context the OData queries are executing under will be a user record from the Staff entity. This is the user that authorization needs to be configured for. Access to the security console application is needed in order to set the needed permissions."),(0,o.yg)("p",null,"The authorization model for the odata endpoint is to either grant permission to query all entities contained within the query data model or to authorize each individual entity that data will be extracted from. Currently there are no tasks available for authorizing by business area or domain. Best practice is to NOT authorize access to the entire query data model so it will be necessary to create an inventoried list of each entity that data will be retrieved from and add the applicable operation for the user. In order to authorize at the operation level, select the role that the user is a member of. Then select Add Permissions. On the resulting page that is displayed, check the Show Operations checkbox. To make the resulting list easier to navigate, you may want to uncheck the Show Tasks, Show Built In Tasks and Show Roles check boxes. Click Apply."),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"AccountBalances",src:n(10398).A,width:"1350",height:"629"})),(0,o.yg)("p",null,"All of the odata query model operations are named as follows: domain + entity name (singluar) + query. So to authorize the permission to retrieve data from the BillingCodeTransaction entity, the StudentAccounts.BillingTransactionCode.Query operation would need to be added for the user."),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"AccountBalances",src:n(51409).A,width:"1350",height:"629"})),(0,o.yg)("p",null,"For the queries discussed in this document, the minimum authorization for the authenticated user will be to the Student, StudentEnrollmentPeriod, StudentAccountTransaction, StudentAccountTransactionAppliedPayment, StudentAccountTransactionConfigureAppliedPayment and Campus entities. Additional entities may be needed depending on the specific use cases being implemented."),(0,o.yg)("h2",{id:"conclusion"},"Conclusion"),(0,o.yg)("p",null,"As can be the case, there may be additional nuances for how to calculate account balances that best match up to the use case at hand that are not covered within this document."),(0,o.yg)("p",null,"If there are questions after reviewing this document, you can submit them by sending an email to ",(0,o.yg)("a",{parentName:"p",href:"mailto:developers@anthology.com"},"developers@anthology.com"),"."))}h.isMDXComponent=!0},92300:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/AccountBalances1-229ad94ec40429cd053fe8af43108a5f.png"},28711:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/AccountBalances2-d8c66ca3dfca20f21cfb404d756bdcb1.png"},10398:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/AccountBalances3-d2cab6308a4ab34f9fedb586933f6984.png"},51409:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/AccountBalances4-6f03b48f35be88d717357abeb0a1f09e.png"}}]);