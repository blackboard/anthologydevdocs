"use strict";(self.webpackChunkanthology_dev_docs=self.webpackChunkanthology_dev_docs||[]).push([[4175],{15680:(e,t,n)=>{n.d(t,{xA:()=>l,yg:()=>m});var a=n(96540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var d=a.createContext({}),u=function(e){var t=a.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},l=function(e){var t=u(e.components);return a.createElement(d.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,d=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),c=u(n),p=o,m=c["".concat(d,".").concat(p)]||c[p]||h[p]||i;return n?a.createElement(m,r(r({ref:t},l),{},{components:n})):a.createElement(m,r({ref:t},l))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=p;var s={};for(var d in t)hasOwnProperty.call(t,d)&&(s[d]=t[d]);s.originalType=e,s[c]="string"==typeof e?e:o,r[1]=s;for(var u=2;u<i;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},6941:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=n(58168),o=(n(96540),n(15680));const i={title:"Refund API Amount Validation",id:"studentapi-refundamountvalidation-details",sidebar_position:1,author:"Jim Burns",published:"",edited:""},r=void 0,s={unversionedId:"student/best-practices/studentapi-refundamountvalidation-details",id:"student/best-practices/studentapi-refundamountvalidation-details",title:"Refund API Amount Validation",description:'A common use case for integrators is to post a refund transaction to a student\'s ledger card. The refund transaction can be a full payment reversal, a partial refund of a particular payment or a refund due to the student withdrawing from school. A common validation message that is returned when attempting to post this refund is "Refund amount cannot exceed #####.##". This document will provide the details on the execution logic that is generating this validation message and steps for calculating the maximum amount that is allowed to be refunded from the Anthology Student data model. Understanding this logic will allow for the necessary corrective steps/actions to be taken to properly address the validation message being returned.',source:"@site/docs/student/best-practices/RefundAmountValidation.md",sourceDirName:"student/best-practices",slug:"/student/best-practices/studentapi-refundamountvalidation-details",permalink:"/docs/student/best-practices/studentapi-refundamountvalidation-details",draft:!1,editUrl:"https://github.com/blackboard/anthologydevdocs/tree/main/docs/student/best-practices/RefundAmountValidation.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Refund API Amount Validation",id:"studentapi-refundamountvalidation-details",sidebar_position:1,author:"Jim Burns",published:"",edited:""},sidebar:"documentationSidebar",previous:{title:"Post Unscheduled Payments",permalink:"/docs/student/best-practices/studentapi-postunscheduledpayment-details"},next:{title:"Add a Future Course for a Student",permalink:"/docs/student/best-practices/studentapi-savestudentcoursefuture-details"}},d={},u=[{value:"Root cause of &quot;Refund amount cannot exceed #####.##&quot; validation message",id:"root-cause-of-refund-amount-cannot-exceed--validation-message",level:2},{value:"Amount Received",id:"amount-received",level:3},{value:"Amount Refunded",id:"amount-refunded",level:3},{value:"Amount Scheduled",id:"amount-scheduled",level:3},{value:"Stipend Amount",id:"stipend-amount",level:3},{value:"Conclusion",id:"conclusion",level:2}],l={toc:u},c="wrapper";function h(e){let{components:t,...i}=e;return(0,o.yg)(c,(0,a.A)({},l,i,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("p",null,'A common use case for integrators is to post a refund transaction to a student\'s ledger card. The refund transaction can be a full payment reversal, a partial refund of a particular payment or a refund due to the student withdrawing from school. A common validation message that is returned when attempting to post this refund is "Refund amount cannot exceed #####.##". This document will provide the details on the execution logic that is generating this validation message and steps for calculating the maximum amount that is allowed to be refunded from the Anthology Student data model. Understanding this logic will allow for the necessary corrective steps/actions to be taken to properly address the validation message being returned.'),(0,o.yg)("p",null,"The API endpoint that is used to post an unscheduled refund is api/student-accounting/ledger-refund-transactions. This is the API where this validation message can be returned."),(0,o.yg)("h2",{id:"root-cause-of-refund-amount-cannot-exceed--validation-message"},'Root cause of "Refund amount cannot exceed #####.##" validation message'),(0,o.yg)("p",null,"Validation logic exists in Anthology Student that will not allow the net amount received for a given packaged student award to be less than 0. Additionally, the net amount received for all other payment/refund transactions that are not associated to a packaged award cannot be less than 0. Transactions not associated to a StudentAward record are grouped by the associated Academic Year Sequence. If the refund is being posted for a packaged award, then certain properties in the request must be populated. The StudentAwardId property in the request will hold the Id of the StudentAward record the refund is associated to. There is also a PaidDisbursementId property as well. If the StudentAwardId property is populated, then the PaidDisbursementId property is optional and can be used to specify the specific received disbursement that is being refunded. If a specific disbursement is referenced with the PaidDisbursementId property, then the refund amount cannot exceed the net amount received for that disbursement."),(0,o.yg)("p",null,"If the refund being posted is not for a packaged award, then the StudentAwardId property will not be populated in the request. When this is the case, the validation logic will use the AcademicYearSequence provided in the request within the calculation to determine the net amount received. The net amount received calculation will include all relevant transactions that are NOT associated to a StudentAward AND have an AcademicYearSequence value that matches what is provided in the request."),(0,o.yg)("p",null,'A good visual aid for how this validation logic works can be found on the Refunds tab when accessing the student\'s ledger card in the web client UI. Once a student record is accessed in the UI, expand Student Accounts and then select the Ledger Card tile. Then select the Refunds tab. When attempting to post a refund or schedule a refund, the validation logic on the proposed refund amount will calculate the net amount received which is "Amount Received" - ("Amount Refunded" + "Amount Scheduled" + "Stipend Amount"). The amount of the refund attempting to be posted is then subtracted from this amount. If the result is less than 0, then the validation message "Refund amount cannot exceed....." will be generated. Note that there will be one row displayed on the grid per StudentAward record that exists for the student. If there are any payment transactions on a student\'s ledger card that are not associated to a StudentAward record, then a row will be displayed on the grid with a Fund Source label of "Student". Also, if these payment transactions have different Academic Year sequence associations, then multiple rows will be listed -- one for each Academic Year sequence.'),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"RefundAmountValidation",src:n(79971).A,width:"1906",height:"868"})),(0,o.yg)("h3",{id:"amount-received"},"Amount Received"),(0,o.yg)("p",null,'This column on the grid is the sum of all payments received for the listed fund source on the grid. As mentioned above, all rows with a fund source label of "Student" are NOT associated to a StudentAward entity record. Depending on how the AcademicYearSequence is associated to "Student" transactions, there may be 1 or more rows shown with this fund source. If there are multiple rows, then this means that there are different values for AcademicYearSequence that have been associated to the "Student" fund source transactions.'),(0,o.yg)("h3",{id:"amount-refunded"},"Amount Refunded"),(0,o.yg)("p",null,"This column on the grid is the sum of refunds that have been paid/processed for the listed fund source on the grid. The entity that stores this information is the Refunds entity. The amount listed will also take into account any processed refunds that have been subsequently been voided. Rows in the Refunds entity with a status of 'P' or 'V' will be included in the calculated amount for this column."),(0,o.yg)("h3",{id:"amount-scheduled"},"Amount Scheduled"),(0,o.yg)("p",null,"This column on the grid is the sum of refunds that are scheduled to be paid but have not yet been processed. Rows in the Refunds entity with a Status of 'N' or 'S' are included in the calculated amount for this column."),(0,o.yg)("h3",{id:"stipend-amount"},"Stipend Amount"),(0,o.yg)("p",null,"This column on the grid is the sum of processed stipends as well as scheduled stipends. A processed stipend will have a row in the Refunds entity. If the row in the Refunds entity is a stipend, then there will be a value in the StipendScheduleId property. If this property is null or 0, then the row is a Refund. A stipend that is scheduled but not yet processed will reside in the StipendSchedule entity and will have a value of 'S' in the Status property."),(0,o.yg)("h2",{id:"conclusion"},"Conclusion"),(0,o.yg)("p",null,'If the "Refund amount cannot exceed......" validation message is received and the refund that is being posted is NOT for a packaged student award record, then the most likely cause of this error is that the AcademicYearSequence property is not being set correctly in the request. As mentioned above, the amount allowed for posting for "Student" fund sources is calculated using the AcademicYearSequence as a grouping value. So if a payment was previously posted and was associated to AcademicYearSequence of 1 but the value in the Refund API payload for AcademicYearSequence is 0, then this validation message will be returned (assuming there are no other payment transactions associated to an AcademicYearSequence of 0).'),(0,o.yg)("p",null,"If there are questions after reviewing this document, you can submit them by sending an email to ",(0,o.yg)("a",{parentName:"p",href:"mailto:developers@anthology.com"},"developers@anthology.com"),"."))}h.isMDXComponent=!0},79971:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/RefundAmountValidation1-0b765c68c4a0967415b0a8611b6d6dc4.png"}}]);