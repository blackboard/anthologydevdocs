"use strict";(globalThis.webpackChunkanthology_dev_docs=globalThis.webpackChunkanthology_dev_docs||[]).push([[9500],{28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>r});var i=n(96540);const o={},a=i.createContext(o);function s(e){const t=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(a.Provider,{value:t},e.children)}},68639:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"blackboard/uef/uef-authentication","title":"Authenticating to UEF","description":"Now that you have the knowledge of how UEF works, the first thing you need to do is authenticate to it. When you respond to the authentication request (after finishing the REST API block from the previous section) with an HTML file that contains the JS file, you will have to do the steps outlined below to authenticate and create the communication channel between Ultra and your file.","source":"@site/docs/blackboard/uef/04-authenticating-to-uef.md","sourceDirName":"blackboard/uef","slug":"/blackboard/uef/uef-authentication","permalink":"/docs/blackboard/uef/uef-authentication","draft":false,"unlisted":false,"editUrl":"https://github.com/blackboard/anthologydevdocs/tree/main/docs/blackboard/uef/04-authenticating-to-uef.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Authenticating to UEF","id":"uef-authentication","sidebar_position":4,"edited":"2024-10-11"},"sidebar":"documentationSidebar","previous":{"title":"Before you start developing for UEF","permalink":"/docs/blackboard/uef/uef-requirements"},"next":{"title":"Migrate a Python LTI Tool to Ultra Extension","permalink":"/docs/blackboard/uef/Tutorials/tutorial-lti"}}');var o=n(74848),a=n(28453);const s={title:"Authenticating to UEF",id:"uef-authentication",sidebar_position:4,edited:"2024-10-11"},r=void 0,c={},h=[{value:"Understanding the scope of the integration",id:"understanding-the-scope-of-the-integration",level:2},{value:"Saying hello \ud83d\udc4b\ud83c\udffb",id:"saying-hello-",level:2},{value:"Authenticating our integration",id:"authenticating-our-integration",level:2},{value:"Subscribing to events",id:"subscribing-to-events",level:2},{value:"Reacting to events",id:"reacting-to-events",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"Now that you have the knowledge of how UEF works, the first thing you need to do is authenticate to it. When you respond to the authentication request (after finishing the REST API block from the previous section) with an HTML file that contains the JS file, you will have to do the steps outlined below to authenticate and create the communication channel between Ultra and your file."}),"\n",(0,o.jsx)(t.p,{children:"But first, let's review the scope of the integration and what information can be accessed from within the JavaScript file."}),"\n",(0,o.jsx)(t.h2,{id:"understanding-the-scope-of-the-integration",children:"Understanding the scope of the integration"}),"\n",(0,o.jsxs)(t.p,{children:["As any file rendered by the browser, you will have a specific context that you can leverage to your advantage and, in some scenarios, get information from other sources. By definition, UEF loads your integration within an iFrame, not visible to the users, where it can send and receive messages. The initial handshake of the integration allows you to access certain parts of the parent window, but it's limited to a subset of them (usually those tied to the ",(0,o.jsx)(t.code,{children:"window.parent"})," property) along with the ability to post browser-wide messages through the MessageChannel API. This last option is used to register the integration with Ultra."]}),"\n",(0,o.jsx)(t.h2,{id:"saying-hello-",children:"Saying hello \ud83d\udc4b\ud83c\udffb"}),"\n",(0,o.jsx)(t.p,{children:"Now that we know that your integration will be scoped to your iFrame and only allowed to access certain properties from the parent, we can register and authenticate your integration. Ultra, by default, doesn't track any JavaScript file that is added to its window since they might or might not be an UEF integration, for this reason, we need to register the integration first."}),"\n",(0,o.jsx)(t.p,{children:"To let Ultra know about your integration, you can post a browser-wide message (using the MessageChannel API), targeting the URL of the learn server and sending a specific payload to register as shown below, we recommend using a wildcard (*) after the Learn domain to start the registration from any part of the system (useful when the user access to Learn through a specific URL other than the root page):"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"window.parent.postMessage(\n  {\n    type: 'integration-hello',\n  },\n  `{learn-domain}/*`\n);\n"})}),"\n",(0,o.jsx)(t.p,{children:"You also need to register an Event Listener for messages, which will allow you to listen for the initial syncronization message from Ultra. The listener can be defined like this:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"addEventListener('message', (incomingMessage) => {\n  // Your code here\n});\n"})}),"\n",(0,o.jsx)(t.p,{children:"Once Ultra is made aware of your integration, it will send a browser-wide message with the following payload:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'{\n  "origin":"{learn_domain}",\n  "data": {\n\t"type": "integration-hello",\n  },\n  "ports": [<MessageChannelPort>]\n}\n'})}),"\n",(0,o.jsxs)(t.p,{children:["From here, you can save the ",(0,o.jsx)(t.code,{children:"port"})," created through the MessageChannel constructor to continue the conversation with Ultra since it will only listen to any subsequent messages through that port."]}),"\n",(0,o.jsx)(t.h2,{id:"authenticating-our-integration",children:"Authenticating our integration"}),"\n",(0,o.jsx)(t.p,{children:"Now that we have a dedicated message channel to communicate with Ultra, we can authenticate and register for specific events. The way we authenticate is through a message sent to learn including the 3-Legged oAuth token generated for the user as seen here:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"incomingMessage.ports[0].postMessage({\n  type: 'authorization:authorize',\n  token: 'token_received_from_3LO',\n});\n"})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.em,{children:"(Building on top of the previous event listener added for messages)"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"addEventListener('message', (incomingMNessage) => {\n  // Validates if the origin of the message is indeed the learn server you're expecting\n  if (incomingMessage.origin !== '{learn_domain}') return;\n\n  // Registers the integration\n  if (incomingMessage.data.type === 'integration:hello') {\n    // Sends the user oAuth token to be able to properly work with UEF and render information based on the user's roles\n    incomingMessage.ports[0].postMessage({\n      type: 'authorization:authorize',\n      token: 'token_received_from_3LO',\n    });\n  }\n});\n"})}),"\n",(0,o.jsx)(t.p,{children:"If Ultra registers the application correctly, you will receive a message through that port with the following information:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'{\n  "origin": "{learn_domain}",\n  "data": {\n    "type": "authorization:authorize"\n  }\n}\n'})}),"\n",(0,o.jsx)(t.p,{children:"This message indicates that is registered and waiting for information regarding the events you want to subscribe to."}),"\n",(0,o.jsx)(t.h2,{id:"subscribing-to-events",children:"Subscribing to events"}),"\n",(0,o.jsx)(t.p,{children:"UEF has different events that can be sent to your JavaScript file and react accordingly, from user hovers and clicks to route changes and help requests. The events available for subscription are the following:"}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{children:"event"}),(0,o.jsx)(t.th,{children:"Description"})]})}),(0,o.jsxs)(t.tbody,{children:[(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"click"})}),(0,o.jsx)(t.td,{children:"Triggered when a user clicks any part of the Ultra UI"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"hover"})}),(0,o.jsx)(t.td,{children:"Triggered when a user hovers any part of the Ultra UI"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"portal:new"})}),(0,o.jsx)(t.td,{children:"Triggered when the system opens a new panel (opening a course view, test settings, peek panel, etc.)"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"portal:remove"})}),(0,o.jsx)(t.td,{children:"Triggered when a panel is closed"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"route"})}),(0,o.jsx)(t.td,{children:"Triggered when the user finishes the navigation to another location (opening a course, changing to the Activity Stream section, etc.)"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"route:changing"})}),(0,o.jsxs)(t.td,{children:["Triggered when the user starts the navigation to another location (opposite to the ",(0,o.jsx)(t.code,{children:"route"})," event)"]})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"lti:launch"})}),(0,o.jsx)(t.td,{children:"Triggered when a user launches and LTI tool/placement/item"})]})]})]}),"\n",(0,o.jsx)(t.p,{children:"from here you can review what events you need and then, subscribe to them sending the following message:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"incomingMessage.ports[0].postMessage({\n  type: 'event:subscribe',\n  subscriptions: [\n    'click',\n    'hover',\n    'route',\n    'portal:new',\n    'portal:remove',\n    'lti:launch',\n  ],\n});\n"})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.em,{children:"(Building on top of the previous event listener added for messages)"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:'addEventListener("message", (incomingMNessage) => {\n  // Validates if the origin of the message is indeed the learn server you\'re expecting\n  if (incomingMessage.origin !== "{learn_domain}") return;\n\n  // Registers the integration\n  if (incomingMessage.data.type === "integration:hello") {\n\t// Sends the user OAuth token to be able to properly work with UEF and render information based on the user\'s roles\n\tincomingMessage.ports[0].postMessage({\n  \ttype: "authorization:authorize",\n  \ttoken: "token_received_from_3LO",\n\t});\n  }\n\n  // Received only when the registration is successful\n  if (incomingMessage.data.type === "authorization:authorize") {\n\t// Subscribes to specific events from Ultra\n\tincomingMessage.ports[0].postMessage({\n  \ttype: "event:subscribe",\n  \tsubscriptions: [\n    \t"click",\n    \t"hover",\n    \t"route",\n    \t"portal:new",\n    \t"portal:remove",\n    \t"lti:launch",\n  \t],,\n\t});\n  }\n});\n'})}),"\n",(0,o.jsx)(t.p,{children:"From here, any type any of the events is triggered, Ultra will send a message through the same port with a payload similar to the ones outlined below."}),"\n",(0,o.jsxs)(n,{children:[(0,o.jsx)("summary",{children:(0,o.jsx)(t.p,{children:"Analytics events (click and hover)"})}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'{\n  "analyticsId": "course.outline.detailsActionButton",\n  "eventType": "click",\n  "type": "event:event"\n}\n'})})]}),"\n",(0,o.jsxs)(n,{children:[(0,o.jsx)("summary",{children:(0,o.jsx)(t.p,{children:"Route Events"})}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'{\n  "eventType": "route",\n  "routeData": {\n    "courseId": "_555_1"\n  },\n  "routeName": "base.courses.peek.course.outline",\n  "type": "event:event"\n}\n'})})]}),"\n",(0,o.jsxs)(n,{children:[(0,o.jsx)("summary",{children:(0,o.jsx)(t.p,{children:"Portal Events"})}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'{\n  "type": "event:event",\n  "portalId": "some-portal-id",\n  "selector": "anonymous-element",\n  "selectorData": {\n    "class": "pageTitle"\n  },\n  "eventType": "new"\n}\n'})})]}),"\n",(0,o.jsx)(t.h2,{id:"reacting-to-events",children:"Reacting to events"}),"\n",(0,o.jsxs)(t.p,{children:["Now that you're subscribed and know that events will arrive through the same MessageChannel port, you can use the same Event Listener to build your handler and react to specific events based on your needs. You can also interconnect your backend service (if needed) to this JavaScript file by performing ",(0,o.jsx)(t.code,{children:"fetch"})," requests within the file."]}),"\n",(0,o.jsx)(t.admonition,{title:"loading times",type:"caution",children:(0,o.jsx)(t.p,{children:"Please be aware that fetch requests to backend services where heavy computational tasks or queries are executed are not recommended since it will severely impact the loading time of your integration and, by extent, the communication with Ultra."})}),"\n",(0,o.jsxs)(t.p,{children:["You can also review the entire specifications and documentation for UEF here ",(0,o.jsx)(t.a,{href:"https://docs.anthology.com/uef-documentation/start.html",children:"https://docs.anthology.com/uef-documentation/start.html"})," to know how to render information on the Ultra UI, register your help providers or create new panels/modals for your data."]}),"\n",(0,o.jsx)(t.p,{children:"We also have available some tutorials in the next section to help you understand and build your own UEF integration."})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}}}]);