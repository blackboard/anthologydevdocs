"use strict";(globalThis.webpackChunkanthology_dev_docs=globalThis.webpackChunkanthology_dev_docs||[]).push([[2506],{28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var t=s(96540);const a={},i=t.createContext(a);function r(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(i.Provider,{value:n},e.children)}},96598:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"blackboard/sis/sis-password-hashes","title":"SIS Password Hash Security","description":"Introduction","source":"@site/docs/blackboard/sis/sis-password-hashes.md","sourceDirName":"blackboard/sis","slug":"/blackboard/sis/sis-password-hashes","permalink":"/docs/blackboard/sis/sis-password-hashes","draft":false,"unlisted":false,"editUrl":"https://github.com/blackboard/anthologydevdocs/tree/main/docs/blackboard/sis/sis-password-hashes.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"SIS Password Hash Security","sidebar_position":2,"id":"sis-password-hashes","author":"John Z. Walthall","published":"","edited":""},"sidebar":"documentationSidebar","previous":{"title":"Getting started with SIS","permalink":"/docs/blackboard/sis/getting-started"},"next":{"title":"Student REST API: First Steps","permalink":"/docs/student/getting-started/first-steps"}}');var a=s(74848),i=s(28453);const r={title:"SIS Password Hash Security",sidebar_position:2,id:"sis-password-hashes",author:"John Z. Walthall",published:"",edited:""},o=void 0,d={},h=[{value:"Introduction",id:"introduction",level:2},{value:"Supplying a Password Hash",id:"supplying-a-password-hash",level:2},{value:"Using MD5",id:"using-md5",level:3},{value:"Using SSHA",id:"using-ssha",level:3},{value:"Algorithm Description",id:"algorithm-description",level:3},{value:"Step by Step",id:"step-by-step",level:3},{value:"Code Examples",id:"code-examples",level:3},{value:"Java",id:"java",level:4},{value:"Python",id:"python",level:4}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,a.jsx)(n.p,{children:"You can create or set user passwords by SIS using the 'Person' data type. There are three ways to do this:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Plaintext (not recommended)"}),"\n",(0,a.jsx)(n.li,{children:"MD5 (not recommended)"}),"\n",(0,a.jsx)(n.li,{children:'Salted SHA-1 ("SSHA", recommended)'}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Here is an example of all three formats. (In each case: the password is 'cyan')"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"user_id|external_person_key|lastname|firstname|passwd|pwencryptiontype|data_source_key\njshaw|jshaw|Shaw|James|{SSHA}foV2dGZ/2FLNdmJUNEpXZ8ijfiGAriwuB9AYrQ==|SSHA|exterminate\njplain|jplain|Plain|Jane|cyan||exterminate\nmd5|md5|Five|Maddy|6411532ba4971f378391776a9db629d3|MD5|exterminate\n"})}),"\n",(0,a.jsx)(n.h2,{id:"supplying-a-password-hash",children:"Supplying a Password Hash"}),"\n",(0,a.jsxs)(n.p,{children:["These hash formats are not the one used by the LMS. When a password is set in the GUI it is hashed using a\n",(0,a.jsx)(n.a,{href:"https://help.blackboard.com/Learn/Administrator/SaaS/Security/Identification_Authentication",children:"512-bit SHA-2-based"})," hash."]}),"\n",(0,a.jsxs)(n.p,{children:["If you supply the field ",(0,a.jsx)(n.code,{children:"passwd"}),", but not the field ",(0,a.jsx)(n.code,{children:"pwencryptiontype"})," (or: set this field to blank) the input will be\nhashed by the LMS using the aforementioned hash."]}),"\n",(0,a.jsx)(n.p,{children:"Otherwise, the input will be copied verbatim into the database. When the user logs in: which is the only time the clear-\ntext of the password is accessible to Blackboard, the cleartext will be re-hashed using a strong hash and the existing\none overwritten."}),"\n",(0,a.jsx)(n.p,{children:"If you set 'change on update' for the password field: the stronger hash will be overwritten."}),"\n",(0,a.jsx)(n.h3,{id:"using-md5",children:"Using MD5"}),"\n",(0,a.jsx)(n.admonition,{type:"danger",children:(0,a.jsx)(n.p,{children:"It's not recommended to use MD5. MD5 is obsolete and no longer secure. It may be subject to removal in a future version\nof Blackboard Learn."})}),"\n",(0,a.jsx)(n.p,{children:"The MD5 hash is trivial: it's simply the standard hex representation of the MD5sum of the string. So if the password is\n'cyan' then"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:'$ echo -n "cyan" | md5\n6411532ba4971f378391776a9db629d3\n'})}),"\n",(0,a.jsx)(n.h3,{id:"using-ssha",children:"Using SSHA"}),"\n",(0,a.jsxs)(n.p,{children:["This format is an informal standard and our implementation is ",(0,a.jsx)(n.em,{children:"similar to"})," but ",(0,a.jsx)(n.em,{children:"not the same as"})," ",(0,a.jsxs)(n.a,{href:"https://github.com/openldap/openldap/blob/34813d9cba02a74216a784636a8d5f0f986d73c7/libraries/liblutil/passwd.c#L749-L779",children:["the format used by\n",(0,a.jsx)(n.code,{children:"slappasswd(8)"})]}),"\nfrom the OpenLDAP project. The key difference is the salt-size. Blackboard Learn uses an ",(0,a.jsx)(n.strong,{children:"8-byte"})," salt. OpenLDAP uses\na ",(0,a.jsx)(n.strong,{children:"4-byte"})," salt. Since the salt-size is not stored in the format, hashes with different salt-lengths are not\ncompatible.\nTherefore, the hashes generated by ",(0,a.jsx)(n.code,{children:"slappasswd(8)"})," cannot be used."]}),"\n",(0,a.jsx)(n.h3,{id:"algorithm-description",children:"Algorithm Description"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"For each password: create 8 random bytes of 'salt'. Never re-use salts. Use a Cryptographically Secure Psuedo-Random\nNumber Generator, or a true environmentally sourced random-number generator."}),"\n",(0,a.jsx)(n.li,{children:"Convert the password string to a byte array using UTF-8."}),"\n",(0,a.jsx)(n.li,{children:"Digest the concatenation of the password bytes + the salt bytes as SHA-1. The SHA-1 digest must be a byte array\nitself, if the implementation produces a hex string, it must be converted to a byte array by parsing each pair of\ncharacters as an unsigned hexadecimal byte."}),"\n",(0,a.jsx)(n.li,{children:"Append another copy of the same salt bytes."}),"\n",(0,a.jsx)(n.li,{children:"Encode this as Base64 in ASCII. Use the default dictionary: not the 'url-safe' one."}),"\n",(0,a.jsxs)(n.li,{children:["Prefix with ",(0,a.jsx)(n.code,{children:"{SSHA}"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"step-by-step",children:"Step by Step"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Let the password be ",(0,a.jsx)(n.code,{children:"nucleus"})]}),"\n",(0,a.jsxs)(n.li,{children:["Let the salt be ",(0,a.jsx)(n.code,{children:"[21, F0, 25, 09, 15, D2, 68, 1F]"})," (interpreted as an array of unsigned bytes.) Remember: it must\nalways be eight new random bytes."]}),"\n",(0,a.jsxs)(n.li,{children:["The UTF-8 bytes of 'nucleus' are ",(0,a.jsx)(n.code,{children:"[6E, 75, 63, 6C, 65, 75, 73]"})]}),"\n",(0,a.jsxs)(n.li,{children:["Thus the value to be digested is ",(0,a.jsx)(n.code,{children:"[6E, 75, 63, 6C, 65, 75, 73, 21, F0, 25, 09, 15, D2, 68, 1F]"})]}),"\n",(0,a.jsxs)(n.li,{children:["The SHA-1 digest of this (interpreted as an array of unsigned bytes) is\n",(0,a.jsx)(n.code,{children:"[90, FC, 6D, A2, C9, EA, 04, 10, 83, 20, C4, AC, 15, 73, A7, 49, BD, 88, 7A, 63]"})]}),"\n",(0,a.jsxs)(n.li,{children:["Appending the salt to that is\n",(0,a.jsx)(n.code,{children:"[90, FC, 6D, A2, C9, EA, 04, 10, 83, 20, C4, AC, 15, 73, A7, 49, BD, 88, 7A, 63, 21, F0, 25, 09, 15, D2, 68, 1F]"})]}),"\n",(0,a.jsxs)(n.li,{children:["The Base64 encoding of this, with prefix is ",(0,a.jsx)(n.code,{children:"{SSHA}kPxtosnqBBCDIMSsFXOnSb2IemMh8CUJFdJoHw=="})]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"code-examples",children:"Code Examples"}),"\n",(0,a.jsx)(n.p,{children:"Here are some code examples."}),"\n",(0,a.jsx)(n.admonition,{type:"caution",children:(0,a.jsxs)(n.p,{children:["A particular source of confusion, and many examples on the Internet stumble on this confusion, is that the SHA-1 output\nmust be bytes, not a hex string. If the programming language or library you choose returns a hex string for SHA-1, then\nit must be recast as a byte array. That is to say: ",(0,a.jsx)(n.code,{children:"EF"})," must be a single byte: ",(0,a.jsx)(n.code,{children:"239"})," (unsigned), not a pair of bytes\nequal to unsigned ",(0,a.jsx)(n.code,{children:"69"})," (the '",(0,a.jsx)(n.code,{children:"E"}),"') and ",(0,a.jsx)(n.code,{children:"70"})," (the '",(0,a.jsx)(n.code,{children:"F"}),"'.)"]})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"According to the SHA-1 specification: an empty string can be hashed. You must not do this. In the SIS API, an empty\npassword indicates the LMS should generate a random password. Setting the password to the SSHA hash of empty string\nresults in a blank password being set."})}),"\n",(0,a.jsx)(n.h4,{id:"java",children:"Java"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'import java.nio.charset.StandardCharsets;\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\nimport java.security.SecureRandom;\nimport java.util.Arrays;\nimport java.util.Base64;\n\n/**\n * Encoder for our nonstandard SSHA variant using 8-byte salt.\n */\npublic final class VariantSSHA {\n\n    /**\n     * Encode string to the hash\n     * @param password The password to encode\n     * @return the variant-SSHA hash.\n     */\n    public static String variantSSHAEncode(String password) {\n        if (password.isBlank()) {\n            // empty-string password has a special meaning in Learn. But a hash of empty-string is a valid hash\n            // bail out to preserve semantics\n            throw new IllegalArgumentException("Password cannot be blank");\n        }\n        // The salt is always 8 bytes. This is incompatible with slappasswd(8)\n        byte[] salt = new byte[8];\n        SecureRandom rand = null;\n        try {\n            rand = SecureRandom.getInstanceStrong();\n        } catch (NoSuchAlgorithmException e) {\n            throw new RuntimeException("FATAL: can\'t load secure randomness", e);\n        }\n        rand.nextBytes(salt);\n\n        byte[] bytesUTF8 = password.getBytes(StandardCharsets.UTF_8);\n\n        try {\n            // hash the combination of the password + the salt.\n            MessageDigest sha1Digest = MessageDigest.getInstance("SHA1");\n            sha1Digest.update(bytesUTF8);\n            sha1Digest.update(salt);\n            byte[] binaryHash = sha1Digest.digest();\n\n            // append the salt to the hash\n            byte[] hashPlusSalt = new byte[binaryHash.length + salt.length];\n            System.arraycopy(binaryHash, 0, hashPlusSalt, 0, binaryHash.length);\n            System.arraycopy(salt, 0, hashPlusSalt, binaryHash.length, salt.length);\n\n            // This is mostly security theater; but customary\n            Arrays.fill(salt, (byte) 0);\n            Arrays.fill(bytesUTF8, (byte) 0);\n\n            String stringHash = "{SSHA}" + Base64.getEncoder().encodeToString(hashPlusSalt);\n            Arrays.fill(hashPlusSalt, (byte) 0);\n\n            return stringHash;\n        } catch (NoSuchAlgorithmException e) {\n            // can\'t happen. JSSE requires all implementing runtimes to support SHA-1\n            throw new RuntimeException(e);\n        }\n    }\n\n    /**\n     * Convenience method to use as a simple utility. Output format is {@code original_password + tab + SSHA}\n     *\n     * <pre>\n     * $ java VariantSSHA.java the quick brown fox" "jumps over the lazy dog" "when zombies arrive" "quickly fax judge patty"\n     *     the quick brown fox\t{SSHA}r+QLZ86dFWWp0oXhGC3nW5U/p08DvFVyKH1M/w==\n     * jumps over the lazy dog\t{SSHA}yxUScjSM42EBpL2qB7I2wLf/CLHBQX0No18z/w==\n     *     when zombies arrive\t{SSHA}Yvot6sr1F7XNahlwY0KeXmmukpw19oYSJnZhRQ==\n     * quickly fax judge patty\t{SSHA}f01o7IJGet6TzvizERwuVzPX7Ud09Pu3HGJeZg==\n     * </pre>\n     * @param args strings to encode.\n     */\n    static void main(String... args) {\n        if (args.length == 0) {\n            System.err.println("Try again");\n            System.err.println("Usage: java VariantSSHA password1 password2 password3...");\n        } else {\n            int pad = Arrays.stream(args).mapToInt(String::length).max().orElse(10);\n            for (String password : args) {\n                System.out.printf("%" + pad + "s\\t%s%n", password, variantSSHAEncode(password));\n            }\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"python",children:"Python"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nGenerate Blackboard\'s nonstandard 8-byte-salted SSHA variant. \n"""\nimport base64\nimport hashlib\nimport os\nimport sys\n\n\ndef variant_ssha_encode(password: str):\n    if password == "":\n        raise RuntimeError("Password can not be empty")\n\n    # Generate 8 random bytes of salt. os.urandom is cryptographically secure\n    salt = os.urandom(8)\n\n    # convert the password to bytes\n    bytes_utf8 = password.encode("utf-8")\n\n    sha1digest = hashlib.sha1()\n\n    # equivalent to byte_utf8 + salt\n    sha1digest.update(bytes_utf8)\n    sha1digest.update(salt)\n\n    # append the salt to the end of the SHA-1 digest (note the digest must be bytes, not hex string)\n    hash_with_salt = sha1digest.digest() + salt\n\n    # encode to base64, pre-fix the identifier and return.\n    return "{SSHA}" + base64.b64encode(hash_with_salt).decode("ascii")\n\n\ndef main():\n    """\n    Convenience method to use as a simple utility\n    invocation:\n        $ python3 generate_ssha_hash.py "the quick brown fox" "jumps over the lazy dog" "when zombies arrive" "quickly fax judge patty"\n            the quick brown fox\t{SSHA}Ffy5dpkMeMIiebd+Sqtu0FJOV6xdAh4Wp9aeSA==\n        jumps over the lazy dog\t{SSHA}SmYwGocJidrBS9AfBid9P/JUUOxhTZLylWcKQw==\n            when zombies arrive\t{SSHA}layQWCu+uVrFmXeKE4ZeqPGzCJ87OVI0zAnjJQ==\n        quickly fax judge patty\t{SSHA}IJbtvQYh6TocBq5m4yoU0sVRvUdMrR+hZUHxCQ==\n    """\n    if len(sys.argv) == 1:\n        print("Try again\\nUsage: python3 generate_ssha_hash.py password1 password2 password3...")\n        sys.exit(1)\n    passwords = sys.argv[1:]\n    pad = len(max(passwords, key=len))\n    for pw in passwords:\n        ssha = variant_ssha_encode(pw)\n        padded = pw.rjust(pad)\n        print(f"{padded}\\t{ssha}")\n\n\nif __name__ == "__main__":\n    main()\n'})})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);