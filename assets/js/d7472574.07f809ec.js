"use strict";(self.webpackChunkanthology_dev_docs=self.webpackChunkanthology_dev_docs||[]).push([[696],{4137:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},l=Object.keys(e);for(o=0;o<l.length;o++)n=l[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||l;return n?o.createElement(h,a(a({ref:t},p),{},{components:n})):o.createElement(h,a({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,a=new Array(l);a[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[u]="string"==typeof e?e:r,a[1]=i;for(var c=2;c<l;c++)a[c]=n[c];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4831:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>b,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var o=n(7462),r=(n(7294),n(4137));const l={layout:"post",title:"Handling the Launch with id_token JWT",id:"id-token",published:"",edited:"",categories:"Standards",author:"Eric Preston"},a=void 0,i={unversionedId:"lti/core/id-token",id:"lti/core/id-token",title:"Handling the Launch with id_token JWT",description:"Overview",source:"@site/docs/lti/core/id-token.md",sourceDirName:"lti/core",slug:"/lti/core/id-token",permalink:"/docs/lti/core/id-token",draft:!1,tags:[],version:"current",frontMatter:{layout:"post",title:"Handling the Launch with id_token JWT",id:"id-token",published:"",edited:"",categories:"Standards",author:"Eric Preston"},sidebar:"documentationSidebar",previous:{title:"LTI In Learn - Turn On All The Switches",permalink:"/docs/lti/turn-on-all-switches"},next:{title:"Handling OIDC Login",permalink:"/docs/lti/core/handling-oidc-login"}},s={},c=[{value:"Overview",id:"overview",level:3},{value:"Sample code",id:"sample-code",level:3},{value:"Sample JWT JSON",id:"sample-jwt-json",level:3}],p=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},u=p("VersioningTracker"),d=p("AuthorBox"),m={toc:c},h="wrapper";function b(e){let{components:t,...n}=e;return(0,r.kt)(h,(0,o.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)(u,{frontMatter:l,mdxType:"VersioningTracker"}),(0,r.kt)("h3",{id:"overview"},"Overview"),(0,r.kt)("p",null,"Once the OIDC login negotiation has succeeded you will receive a FORM POST from the browser with two form paramaters:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"id_token - this is the JSON Web Token (JWT) that contains all the launch information. See ",(0,r.kt)("a",{parentName:"li",href:"https://jwt.io"},"jwt.io")," for more information on JWTs. You can also use that site to inspect any JWTs you receive (or create)."),(0,r.kt)("li",{parentName:"ol"},"state - if you sent a state value back in the OIDC auth response you will receive this as a URL parameter. You can (should?) use to to ensure the user who initiated the OIDC login is the same user issuing the launch.")),(0,r.kt)("p",null,"These are the basic steps you should upon receiving the id_token JWT:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Verify the token",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Get the header, body, and signature from the JWT (these parts are separated by a period ",(0,r.kt)("inlineCode",{parentName:"li"},".")),(0,r.kt)("li",{parentName:"ol"},"Verify the signing algorithm is what you expect"),(0,r.kt)("li",{parentName:"ol"},"Get the Client ID and its JWKS URL."),(0,r.kt)("li",{parentName:"ol"},"Validate the signature, using a JWT library"))),(0,r.kt)("li",{parentName:"ol"},"Parse the body into JSON - you now have all the information you need to handle the launch for your tool")),(0,r.kt)("h3",{id:"sample-code"},"Sample code"),(0,r.kt)("p",null,"Some sample code in Node.js is below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'exports.handleIdToken = function(id_token) {\n  let parts = id_token.split(".");\n\n  let header = JSON.parse(Buffer.from(parts[0], "base64").toString());\n  let body = JSON.parse(Buffer.from(parts[1], "base64").toString());\n\n  // Verify launch is from correct party\n  // aud could be an array or a single entry\n  let clientId;\n  if (jwtPayload.body.aud instanceof Array) {\n    clientId = jwtPayload.body.aud[0];\n  } else {\n    clientId = jwtPayload.body.aud;\n  }\n\n  let publicKey = // Get public key from the configured JWKS URL using the kid in the header of the JWT\n\n  jwt.verify(id_token, jwk2pem(publicKey));\n\n  // All is good so run with the JWT body\n};\n')),(0,r.kt)("h3",{id:"sample-jwt-json"},"Sample JWT JSON"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "kid": "53c4573a-1ac8-4484-b036-a7b22b557e8c",\n  "alg": "RS256"\n}\n\n{\n  "sub": "4f1025ffab1846ee9ca0a53299dd51b6",\n  "https://purl.imsglobal.org/spec/lti/claim/deployment_id": "c3c37f92-d008-43db-9e8a-e10fd139ec2d",\n  "https://purl.imsglobal.org/spec/lti/claim/version": "1.3.0",\n  "https://purl.imsglobal.org/spec/lti-ags/claim/endpoint": {\n    "lineitems": "https://example.com/learn/api/v1/lti/courses/_122_1/lineItems",\n    "lineitem": "https://example.com/learn/api/v1/lti/courses/_122_1/lineItems/_7454_1",\n    "scope": [\n      "https://purl.imsglobal.org/spec/lti-ags/scope/lineitem",\n      "https://purl.imsglobal.org/spec/lti-ags/scope/result.readonly",\n      "https://purl.imsglobal.org/spec/lti-ags/scope/score"\n    ]\n  },\n  "iss": "https://blackboard.com",\n  "locale": "en-US",\n  "https://purl.imsglobal.org/spec/lti/claim/tool_platform": {\n    "name": "Blackboard, Inc.",\n    "description": "Blackboard, Inc.",\n    "guid": "b6932d2ade8c441982b53f99dcf0caf3",\n    "product_family_code": "BlackboardLearn",\n    "version": "3900.11.0-ci.7045+d7e0341",\n    "url": "https://example.com/",\n    "contact_email": "admin@example.com"\n  },\n  "https://purl.imsglobal.org/spec/lti/claim/custom": {\n    "userNameLTI": "jcool",\n    "caliper_profile_url": "https://example.com/learn/api/v1/telemetry/caliper/profile",\n    "caliper_federated_session_id": "https://caliper-mapping.cloudbb.blackboard.com/v1/sites/e0c7f37e-d260-4a83-b086-5cbbdb997bce/sessions/3DE97D40358C65C13681A22C004344DF",\n  },\n  "https://purl.imsglobal.org/spec/lti/claim/lis": {\n    "person_sourcedid": "9283749283749",\n    "course_section_sourcedid": "COURSE1-923749238"\n  },\n  "https://purl.imsglobal.org/spec/lti/claim/launch_presentation": {\n    "return_url": "https://example.com/webapps/blackboard/execute/blti/launchReturn?course_id=_122_1&content_id=_18938_1&toGC=false&launch_id=46e5c1e7-a68a-40e8-80c3-fe24a2ed1195&link_id=_18938_1&launch_time=1614630380476"\n  },\n  "exp": 1614633980,\n  "iat": 1614630380,\n  "email": "jcool@example.com",\n  "https://purl.imsglobal.org/spec/lti-nrps/claim/namesroleservice": {\n    "context_memberships_url": "https://example.com/learn/api/v1/lti/external/namesandroles/_122_1?placement_id=_553_1",\n    "scope": [\n      "https://purl.imsglobal.org/spec/lti-nrps/scope/contextmembership.readonly"\n    ],\n    "service_versions": [\n      "2.0"\n    ]\n  },\n  "given_name": "Joe",\n  "https://purl.imsglobal.org/spec/lti/claim/roles": [\n    "http://purl.imsglobal.org/vocab/lis/v2/membership#Instructor"\n  ],\n  "nonce": "cb972240-2a01-45c6-954f-036c1153722b",\n  "https://purl.imsglobal.org/spec/lti/claim/target_link_uri": "https://example.com/lti13",\n  "https://purl.imsglobal.org/spec/lti/claim/context": {\n    "id": "6c19281a08504db5a447b511f00c0c7b",\n    "label": "COURSE1",\n    "title": "Course One",\n    "type": [\n      "http://purl.imsglobal.org/vocab/lis/v2/course#CourseOffering"\n    ]\n  },\n  "https://purl.imsglobal.org/spec/lti/claim/resource_link": {\n    "description": "A course content link",\n    "id": "_18938_1",\n    "title": "LTI JWT Content"\n  },\n  "https://purl.imsglobal.org/spec/lti-gs/claim/groupsservice": {\n    "context_groups_url": "https://example.com/learn/api/v1/lti/courses/_122_1/groups",\n    "context_group_sets_url": "https://example.com/learn/api/v1/lti/courses/_122_1/groupsets",\n    "scope": [\n      "https://purl.imsglobal.org/spec/lti-gs/scope/contextgroup.readonly"\n    ],\n    "service_versions": [\n      "1.0"\n    ]\n  },\n  "aud": "53c4573a-1ac8-4484-b036-a7b22b557e8c",\n  "https://purl.imsglobal.org/spec/lti/claim/message_type": "LtiResourceLinkRequest",\n  "name": "Joe Cool",\n  "family_name": "Cool"\n}\n')),(0,r.kt)(d,{frontMatter:l,mdxType:"AuthorBox"}))}b.isMDXComponent=!0}}]);