"use strict";(self.webpackChunkanthology_dev_docs=self.webpackChunkanthology_dev_docs||[]).push([[5847],{4137:(e,t,a)=>{a.d(t,{Zo:()=>h,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},h=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,h=s(e,["components","mdxType","originalType","parentName"]),c=p(a),u=r,m=c["".concat(l,".").concat(u)]||c[u]||d[u]||o;return a?n.createElement(m,i(i({ref:t},h),{},{components:a})):n.createElement(m,i({ref:t},h))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},4860:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>k,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=a(7462),r=(a(7294),a(4137));const o={title:"3LO",id:"3lo",categories:"Learn REST",sidebar_position:8,author:"Scott Hurrey",published:"",edited:""},i=void 0,s={unversionedId:"rest-apis/learn/getting-started/3lo",id:"rest-apis/learn/getting-started/3lo",title:"3LO",description:"One of the drawbacks associated with Basic Authentication is that the application requires broad access, as the tool",source:"@site/docs/rest-apis/learn/getting-started/3lo.md",sourceDirName:"rest-apis/learn/getting-started",slug:"/rest-apis/learn/getting-started/3lo",permalink:"/docs/rest-apis/learn/getting-started/3lo",draft:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"3LO",id:"3lo",categories:"Learn REST",sidebar_position:8,author:"Scott Hurrey",published:"",edited:""},sidebar:"documentationSidebar",previous:{title:"Releasing your Integration",permalink:"/docs/rest-apis/learn/getting-started/releasing-your-integration"},next:{title:"REST Tutorials",permalink:"/docs/rest-apis/learn/getting-started/tutorials"}},l={},p=[{value:"Refresh Tokens",id:"refresh-tokens",level:3},{value:"Use Proof Key for Code Exchange (PKCE) with 3-Legged OAuth 2.0",id:"use-proof-key-for-code-exchange-pkce-with-3-legged-oauth-20",level:3},{value:"Examples",id:"examples",level:3}],h=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},c=h("VersioningTracker"),d=h("AuthorBox"),u={toc:p},m="wrapper";function k(e){let{components:t,...i}=e;return(0,r.kt)(m,(0,n.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)(c,{frontMatter:o,mdxType:"VersioningTracker"}),(0,r.kt)("h1",{id:"three-legged-oauth"},"Three-Legged OAuth"),(0,r.kt)("p",null,"One of the drawbacks associated with ",(0,r.kt)("a",{parentName:"p",href:"/docs/rest-apis/learn/getting-started/basic-authentication"},"Basic Authentication")," is that the application requires broad access, as the tool\nis acting as a system-level user and enacting for the user. Three-legged OAuth\n(3LO) allows an application to act as a user. This sounds scary, but it\nactually allows for much more granular access control. Rather than a system\nuser acting as someone that can modify all courses, the application is now\nacting as Professor X, and as such, only has access to his or her courses."),(0,r.kt)("p",null,"As of Learn 3200.7 (SaaS deployed release), third-party REST\napplications now have the ability to implement 3LO to authorize a user against\nthe APIs and act as that user. In the spirit of sharing pretty pictures, here\nis a nice diagram displaying the workflow:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"3_legged_oauth_workflow.png",src:a(6968).Z,width:"1262",height:"604"})),(0,r.kt)("p",null,"So let's talk a bit about what is happening here. Let's pretend that we have\nbuilt a mobile app that allows a student to get his or her grades. Today, we\nwill be Marlee. Marlee picks up her iPhone and opens the GetMyGrades app. The\nfirst time Marlee opens the app, the app will send a GET request to\n",(0,r.kt)("inlineCode",{parentName:"p"},"/learn/api/public/v1/oauth2/authorizationcode")," with the Content-Type set to\n",(0,r.kt)("inlineCode",{parentName:"p"},"form/urlencoded")," and the following data as query parameters:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Definition"),(0,r.kt)("th",{parentName:"tr",align:null},"Example"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"redirect_uri"),(0,r.kt)("td",{parentName:"tr",align:null},"Where to redirect the user once they have authorized the application"),(0,r.kt)("td",{parentName:"tr",align:null},"redirect_uri=",(0,r.kt)("a",{parentName:"td",href:"https://my.edu/authorized"},"https://my.edu/authorized"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"response_type"),(0,r.kt)("td",{parentName:"tr",align:null},"Must be set to code. Tells the endpoint to return an authorization code"),(0,r.kt)("td",{parentName:"tr",align:null},"response_type=code")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"client_id"),(0,r.kt)("td",{parentName:"tr",align:null},"The application's OAuth ",(0,r.kt)("strong",{parentName:"td"},"key"),", from the ",(0,r.kt)("strong",{parentName:"td"},"key"),"/secret pair as registered in the developer portal.",(0,r.kt)("br",null),(0,r.kt)("strong",{parentName:"td"},"NOTE: This is NOT the Application ID!!")),(0,r.kt)("td",{parentName:"tr",align:null},"client_id=8DBBA050-B830-414F-B7F1-0B448A6320C9")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"scope"),(0,r.kt)("td",{parentName:"tr",align:null},"The application's permissions: read, write, delete, and/or offline.",(0,r.kt)("br",null),"Offline is required to use Refresh Tokens",(0,r.kt)("br",null),(0,r.kt)("em",{parentName:"td"},(0,r.kt)("strong",{parentName:"em"},"CAUTION")),": If you do not ",(0,r.kt)("strong",{parentName:"td"},"set the scope appropriately")," you will still be able to get an access_token, but when using the access_token you will not be able to GET, POST, or UPDATE as expected. Instead you will get error responses."),(0,r.kt)("td",{parentName:"tr",align:null},"scope=read")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"state"),(0,r.kt)("td",{parentName:"tr",align:null},"Opaque value used to prevent Cross Site Request Forgery"),(0,r.kt)("td",{parentName:"tr",align:null},"state=DC1067EE-63B9-40FE-A0AD-B9AC069BF4B0")))),(0,r.kt)("p",null,"{: .striped}"),(0,r.kt)("p",null,"So in this example, my request would look like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"GET /learn/api/public/v1/oauth2/authorizationcode?redirect_uri =\nhttps://my.edu/authorized&response_type=code&client_id=8DBBA050-B830-414F-B7F1-0B448A6320C9&scope=read&\nstate=DC1067EE-63B9-40FE-A0AD-B9AC069BF4B0\n")),(0,r.kt)("p",null,"The result of this action is that Marlee is presented with her school's\nLearn login screen. She logs in and is presented with the following\nscreen, asking her to authorize the application."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"3-loauth-screenshot",src:a(6233).Z,width:"350",height:"635"})),(0,r.kt)("p",null,"Once Marlee clicks 'Allow', the URL sent as the redirect uri is called with\nthe authorization code as a query parameter, for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"https://my.edu/authorized?code=1234567890\n")),(0,r.kt)("p",null,"Now the application is able to talk server-to-server as Marlee. The next step\nis to get an access token from Learn based on the authorization code Marlee\ngranted. From here the workflow is very similar to the Basic Authentication\nmethod. The token is requested as a POST request from\n",(0,r.kt)("inlineCode",{parentName:"p"},"/learn/api/public/v1/oauth2/token"),". This is also a ",(0,r.kt)("inlineCode",{parentName:"p"},"form/urlencoded"),". The body of\nthe request contains the text ",(0,r.kt)("inlineCode",{parentName:"p"},"grant_type=authorization_code"),", and the URL is\nparameterized with the code ",(0,r.kt)("inlineCode",{parentName:"p"},"code=1234567890")," and the redirect_uri\n",(0,r.kt)("inlineCode",{parentName:"p"},"redirect_uri=https://my.edu/app"),". So the request looks like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST /learn/api/public/v1/oauth2/token?code=1234567890&redirect_uri=https://my.edu/app\n")),(0,r.kt)("p",null,"The endpoint responds with the standard token (access_token, expires_in, and\ntoken_type), but also has a couple of new fields. If offline mode is granted,\na refresh_token is returned. This allows the application to get a new token on\nbehalf of the user, even if that user isn't explicitly asking for it. In\naddition, the scope requested in the initial request is returned, as well as\nthe UUID for the user in the user_id field."),(0,r.kt)("p",null,"From this point forward, the access_token is used just as it is when using\nBasic Authentication, but instead of acting as the system user, it is acting\nas Marlee."),(0,r.kt)("h3",{id:"refresh-tokens"},"Refresh Tokens"),(0,r.kt)("p",null,"As mentioned above, one of the available scopes that an application can\nrequest is offline. Essentially, the offline scope allows an application to\naccess Learn as a user without requiring the user to login each\ntime. This might be especially useful in a mobile application to prevent the\nunnecessary redirects each time an application is loaded. The way this works\nis through the use of refresh tokens."),(0,r.kt)("p",null,"The first time a user accesses the application and the normal 3LO process\ntakes place. The user is redirected to Learn, they login and authorize,\nand then the application is off an running. The difference is that a refresh\ntoken is returned in addition to the Bearer token. From this point forward,\nthe third party application can automatically request a new bearer token by\nsending the request with the refresh token without involving the user at all."),(0,r.kt)("p",null,"The HTTP message might look like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST /learn/api/public/v1/oauth2/token?refresh_token=8DBBA050-B830-414F-B7F1-0B448A6320C9&redirect_uri=https://my.edu/app\n")),(0,r.kt)("p",null,"From this point forward, the access_token is used just as it is when using\nBasic Authentication, but instead of acting as the system user, it is acting\nas Marlee."),(0,r.kt)("h3",{id:"use-proof-key-for-code-exchange-pkce-with-3-legged-oauth-20"},"Use Proof Key for Code Exchange (PKCE) with 3-Legged OAuth 2.0"),(0,r.kt)("p",null,"Starting in version 3700.4, Learn's 3-Legged OAuth 2.0\nimplementation supports the Proof Key for Code Exchange (PKCE) extension. For\nmore information about PKCE, see ",(0,r.kt)("a",{parentName:"p",href:"https://oauth.net/2/pkce"},"OAuth 2.0's RFC 7636: Proof Key for Code Exchange"),"."),(0,r.kt)("p",null,"To implement the PKCE extension:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a random string 43-128 characters long, containing only the characters A-Z, a-z, 0-9, or the following - . ","_"," ~ (hyphen, period, underscore, and tilde). This sting will later be used as your code_verifier.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Use the S256 hashing method to create a hash of your random string. This hash is your code_challenge. The formula for an S256 hash is based on the SHA-256, but is not exactly the same.",(0,r.kt)("br",{parentName:"p"}),"\n","code_challenge = BASE64URL_ENCODE( SHA256( ASCII( code_verifier )))"))),(0,r.kt)("p",null,"For more information about the S256 hashing algorithm, see ",(0,r.kt)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc7636%23section-4.2"},"RFC 7636 - Proof Key for Code Exchange by OAuth Public Clients"),"."),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Make a request to ",(0,r.kt)("inlineCode",{parentName:"li"},"/learn/api/public/v1/oauth2/authorizationcode"),", and provide a ",(0,r.kt)("inlineCode",{parentName:"li"},"code_challenge")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"code_challenge_method")," in the query parameters. For ",(0,r.kt)("inlineCode",{parentName:"li"},"code_challenge_method"),", the endpoint accepts only ",(0,r.kt)("inlineCode",{parentName:"li"},"S256"),". Your request will look something like:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST learn/api/public/v1/oauth2/authorizationcode?client_id=YOUR_CLIENT_ID&response_type=code&redirect_url=YOUR_URL&code_challenge=YOUR_CODE_CHALLENGE&code_challenge_method=S256\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Make a request for an access token, as normal. When you do, include your code_verifier as a query parameter. Your request will look like:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST learn/api/public/v1/oauth2/token?grant_type=authorization_code&code=CODE_FROM_AUTH_CALL&code_verifier=YOUR_CODE_VERIFIER\n")),(0,r.kt)("p",null,"The Learn server will verify that the code_challenge and code_challenge_method\nsent in the first request form a valid hash of code_verifier. This allows to\nthe server to verify that the client asking for the access token is the same\nclient that sent the authorization code request."),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"When you receive an access token, you can use it as you normally would to make API calls.")),(0,r.kt)("h3",{id:"examples"},"Examples"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/rest-apis/learn/examples/curl-demo"},"Three-legged OAuth in Curl")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/blackboard/BBDN-3LO-REST-Swift"},"BBDN-3LO-REST-Swift"))),(0,r.kt)(d,{frontMatter:o,mdxType:"AuthorBox"}))}k.isMDXComponent=!0},6233:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/3loauthscreenshot-a9de77cc2a2fb2960684a397271bf554.png"},6968:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/3loworkflow-10ca088dfadb4bb91fc62845febc71bd.png"}}]);