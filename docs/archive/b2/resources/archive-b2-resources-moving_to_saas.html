<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-archive/b2/resources/archive-b2-resources-moving_to_saas">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Preparing Your Building Blocks For Learn SaaS and Newer Learn Versions | Anthology Developer Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blackboard.github.io/anthologydevdocs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blackboard.github.io/anthologydevdocs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blackboard.github.io/anthologydevdocs/docs/archive/b2/resources/archive-b2-resources-moving_to_saas"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Preparing Your Building Blocks For Learn SaaS and Newer Learn Versions | Anthology Developer Documentation"><meta data-rh="true" name="description" content="This document is deprecated!"><meta data-rh="true" property="og:description" content="This document is deprecated!"><link data-rh="true" rel="icon" href="/anthologydevdocs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blackboard.github.io/anthologydevdocs/docs/archive/b2/resources/archive-b2-resources-moving_to_saas"><link data-rh="true" rel="alternate" href="https://blackboard.github.io/anthologydevdocs/docs/archive/b2/resources/archive-b2-resources-moving_to_saas" hreflang="en"><link data-rh="true" rel="alternate" href="https://blackboard.github.io/anthologydevdocs/docs/archive/b2/resources/archive-b2-resources-moving_to_saas" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/anthologydevdocs/blog/rss.xml" title="Anthology Developer Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/anthologydevdocs/blog/atom.xml" title="Anthology Developer Documentation Atom Feed"><link rel="stylesheet" href="/anthologydevdocs/assets/css/styles.7d71cb32.css">
<link rel="preload" href="/anthologydevdocs/assets/js/runtime~main.86a85da2.js" as="script">
<link rel="preload" href="/anthologydevdocs/assets/js/main.8f957423.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#262626;color:#d5d5d5" role="banner"><div class="content_knG7 announcementBarContent_xLdY">The Developer Portal will be updated June 6, 2023 at 6AM EDT. See <a href="https://musical-adventure-wl1kq5k.pages.github.io/docs/Developer%20Portal/devportal-intro#release_notes" target="_top"> the Developer Portal release notes</a> for more detail.</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/anthologydevdocs/"><div class="navbar__logo"><img src="/anthologydevdocs/img/ANTHOLOGY-Logo-RGB.svg" alt="Anthology Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/anthologydevdocs/img/ANTHOLOGY-Logo-RGB.svg" alt="Anthology Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">anthology</b></a><a class="navbar__item navbar__link" href="/anthologydevdocs/docs/site-intro">Documentation</a><a class="navbar__item navbar__link" href="/anthologydevdocs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/search?q=org%3Ablackboard+blackboard%2FBBDN-" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/anthologydevdocs/docs/site-intro">Welcome to our Developer Documentation!</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/anthologydevdocs/docs/REST APIs/apis-intro">REST APIs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/anthologydevdocs/docs/LTI/lti-intro">LTI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/anthologydevdocs/docs/Standards/standards-intro">Standards</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/anthologydevdocs/docs/Developer Portal/devportal-intro">Developer Portal</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/anthologydevdocs/docs/Partners/partners-become_a_partner">Partners</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/anthologydevdocs/docs/Community/community-intro">Community</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/anthologydevdocs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Preparing Your Building Blocks For Learn SaaS and Newer Learn Versions</h1></header><p>⚠️ This document is deprecated!</p><h1>Preparing Your Building Blocks For Learn SaaS and Newer Learn Versions</h1><p>Blackboard Building Blocks have long been a staple in the Blackboard Learn
platform. These Java Web Apps allow you to customize the workflow and
experience that you and your faculty use to interact with the system.</p><p>We realize that this is an important part of the Learn ecosystem, and so
Blackboard Learn SaaS with the Original Experience will continue to support
your Building Blocks going forward<strong>*</strong>. That said, the architecture of the
SaaS-delivered platform is dramatically different than that of the self- and
managed-hosted servers you are used to. As a result, your Building Block will
likely need to be modified to run in the new Blackboard.</p><p><strong>The following sections list requirements that must be met for a B2 to function in a SaaS environment</strong>. For example, your B2 must be compiled with Java 8, the database may be Postgres so the best practice is to use Schema.xml, the shared content must be accessed as described below, etc. Many of these are also requirements for a B2 to function on Learn Q2 2016 (3000.x.x) and Q4 2016 (3100.x.x). The best practice is to code to meet all of these requirements, then your B2 will function on SaaS, Managed Hosted, and Self Hosted systems.</p><p><strong>*<!-- -->Note:</strong> Building Blocks cannot surface content in an Ultra course, <strong>ever</strong>. B2s meant designed to work with Original Experience courses can continue to work in SaaS, provided they meet the requirements documented here. Ultra Courses surface content from the Content Market - which are built on Partner Cloud, or the LTI standard &amp; Blackboard Learn REST APIs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="apis">APIs<a href="#apis" class="hash-link" aria-label="Direct link to APIs" title="Direct link to APIs">​</a></h2><p>Only use the <a href="/anthologydevdocs/docs/archive/b2/getting-started/archive-b2-gs-api_docs">published APIs</a>. If it&#x27;s not published, it&#x27;s private. Our product development
team is cleaning up and refactoring a lot of code. If you&#x27;re using private
APIs, there is a good chance they will stop working. So, remove all use of
private APIs. For example we&#x27;ve discovered that B2s that depend on
<strong>DocumentManagerEx</strong> now fail in newer versions of Learn.
<strong>DocumentManagerEx</strong> is private. Don&#x27;t use it. Eliminate the use of all
private APIs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="database">Database<a href="#database" class="hash-link" aria-label="Direct link to Database" title="Direct link to Database">​</a></h2><p>In SaaS, the database schema name will no longer be <strong>BBLEARN</strong> or
<strong>bb_bb60</strong>. Your B2 code must determine the actual schema name if it has any
dependency on the value. See <a href="https://community.blackboard.com/blogs/4/23" target="_blank" rel="noopener noreferrer">Bye Bye BBLEARN &amp; bb_bb60</a></p><p>Also, in SaaS, the database is Postgres. If you’ve been testing your code on
the Developer Virtual Machine, this isn’t that big of a deal. Schema.xml will
continue to be supported as it is today. If you are providing SQL statements
in the form of stored procedures, post_schema_updates, etc, you will just need
to be sure to supply those files in postgres form, as well. These files will
take the suffix, <strong>db-pgsql</strong>. If a self or managed-hosted client is migrating
your B2 to SaaS via a &quot;full database migration&quot; be certain to read <a href="https://community.blackboard.com/blogs/4/24" target="_blank" rel="noopener noreferrer">SaaS
Migrations - Sequences and Tables</a>.</p><p>In addition, its important to note that Exceptions encountered during postgres
transactions stop all processing. You must code to handle this occurrence. One
approach is to create a save point before you start the transaction and roll
back to that save point upon exception. Here’s a small sample demonstrating
this.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Much of the error handling stripped for space</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static T withSavePoint(Callable c, Connection con) throws SQLException</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Savepoint savepoint = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ( null != con &amp;&amp; !con.getAutoCommit() ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      savepoint = con.setSavepoint();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return c.call();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } catch ( SQLException e ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ( con != null &amp;&amp; savepoint != null ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      con.rollback( savepoint );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw e;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Postgres handles timestamps differently. There are two types of timestamps:
<strong>localtimestamp</strong> and <strong>clock_timestamp::timestamp</strong>. The <strong>localtimestamp</strong>
returns the time at the start of the transaction. The
<strong>clock_timestamp()::timestamp</strong> returns the actual current time. As a result,
it is best practice to use <strong>clock_timestamp()::timestamp</strong> in your Building
Block, as this matches the behavior of timestamps in other databases.</p><p>Avoid the use of <strong>data-templates</strong> for management of objects that can be
managed through the bb-manifest.xml file. This includes rows in tables like
application, navigation_item, and entitlements. The use of data-templates both
adds risk to live-upgrades and loses customizations (application status,
entitlement-to-role mappings, etc.).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="shared-content-folder">Shared Content Folder<a href="#shared-content-folder" class="hash-link" aria-label="Direct link to Shared Content Folder" title="Direct link to Shared Content Folder">​</a></h2><p>In the Enterprise Blackboard Learn you are accustomed to developing for, the
Building Block home lives in the shared content directory. For instance, if I
wrote a building block and set my vendor ID to ‘bbdn’ and my plugin handle to
‘my-b2’, my building block and all of its related files would live in
<strong>blackboard/content/vi/BBLEARN/plugins/bbdn-my-b2</strong>, and this directory would
exist once, in only one place, so changes were persisted to all application
servers.</p><p>In Learn SaaS, there are two building block homes. There is still the shared
file system that is shared among the entire group of application servers, but
there is also a local cache on each individual server. As a result, the
Building Block would still reside in the shared directory, similar to
<strong>blackboard/content/vi/BBLEARN/plugins/bbdn-my-b2</strong>, however the web app
would live in the local cache on each server, in a directory similar to
<strong>blackboard/cache/vi/BBLEARN/plugins/bbdn-my-b2</strong>.</p><p>As a result of this change, several of the Plugin API methods have been
modified to handle the dual-folder deployment.
<strong>PlugInManager.getPlugInDir()</strong> and <strong>PlugInManager.getPluginsDirectory()</strong>
can now only be used to access the read-only files from the exploded war in
the cache folder. If you need to access the shared config folder for your
Building Block, you can use <strong>PlugInUtil.getConfigDirectory()</strong>. Calling
methods like <strong>ServletContent.getRealPath()</strong> will point to the cache folder,
so be sure that any method you are calling that returns a path or a file is
returning what you expect it to.</p><p>As an example, with prior versions of Learn you could use the following code
to write to a file in your plugin’s folder and create a configuration file:</p><div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PlugInManager manager = PlugInManagerFactory.getInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">File myDir = manager.getPlugInDir( manager.getPlugIn( &quot;myVendorId&quot;,&quot;myB2Handle&quot; ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">File myConfigDir = new File( myDir, &quot;config&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">File myConfigFile = new File( myConfigDir, &quot;config.txt&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// read/write myConfigFile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You will now need to re-write the above code code to look like the following:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">File myConfigDir = PlugInUtil.getConfigDirectory( &quot;myVendorId&quot;, &quot;myB2Handle&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">File myConfigFile = new File(myConfigDir, “config.txt”);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// read/write myConfigFile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you just need to read from a file that is included with in your Building
Block, you can use the following code snippet to access the cached copy.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PlugInManager manager = PlugInManagerFactory.getInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">File myDir = manager.getPlugInDir( manager.getPlugIn( &quot;myVendorId&quot;,&quot;myB2Handle&quot; ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">File myStaticDirectory = new File (myDir, &quot;webapp/myStaticStuff&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// read from myStaticDirectory - files as originally present in war file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-See codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-See codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shared content folder.~~~ Note: we no longer provide a local DVM. You must contact us for a special build of the AWS AMI.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Eventually, all write access to the shared folder will be phased out, and</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write access for logging will be limited to the log directory returned by</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PlugInUtil.getLogDirectory(). Prior to this change, a new way will be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">documented to achieve the same goal without writing directly to the backend of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">the server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Logging Changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In SaaS, logging is handled a bit differently, as clients will not have back-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end access to the system. You can still log to the log directory, but those</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logs are redirected to Kibana so your Building Block won’t be able to read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">that log file. There will be access to the logs through the System Admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">panel.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In order to see your B2s logs in Kibana-Elasticsearch, the only SaaS interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for log files, your B2 must do the following:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Write the log files to the directory returned by **blackboard.platform.plugin.PlugInUtil.getLogDirectory.**[**PlugInUtil** (Building Blocks API 3000.1.0)](https://library.blackboard.com/ref/16ce28ed-bbca-4c63-8a85-8427e135a710/blackboard/platform/plugin/PlugInUtil.html){: target:\_blank}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   1. Typically looks like **&amp;lt;blackboard home&amp;gt;/logs/plugins/&amp;lt;vendorId&amp;gt;-&amp;lt;handle%gt;/...**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   2. Read the API documentation on how to get write permission.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Use this format, with four columns that are pipe separated:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-03-15 01:00:00 | DEBUG | 41:c.b.c.i.task.UsageReportingTask | Generating Usage Report...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-03-15 01:00:00 | ERROR | 68:o.s.s.support.MethodInvokingRunnable | Invocation of method &#x27;doUsageReport&#x27; on target class ...failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java.lang.NullPointerException: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  at com.blackboard.consulting.internships.task.UsageReportingTask.getFirstTimeActivationDateModified(UsageReportingTask.java:68)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The b2 logging configuration in the logback.xml file that produces this log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">format is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;appender ... &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;encoder&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;pattern&gt;%date{yyyy-MM-dd HH:mm:ss} | %-5level | %-45(%L:%logger{40}) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%m%n%ex{10}&lt;/pattern&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/encoder&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/appender&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**[Sample logging code that works in a SaaS environment.](https://github.com/mark-b-kauffman/bbdn-bblogbackb2){: target:\_blank}**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Statelessness</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The Learn SaaS cloud architecture is built to the best practices of cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">computing. As such, in SaaS, Learn is stateless. As a result, you can no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">longer rely on **HttpSession** persisting across requests. As a result,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Building Blocks that synchronize data on sessions will need to be refactored.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You can still use **BbSession.setGlobalKey()** to store data, but you will</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">need to be cognizant of the size of the data, as this is stored in the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">database.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">As an example, if you currently employ code like the following to store an</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object in the session:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">request.getSession().setAttribute( &quot;myKey&quot;, &quot;myValue&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">request.getSession().setAttribute( &quot;myObjectKey&quot;, myObject );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You will need to refactor to look like this:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ContextManagerFactory.getInstance().getContext().getSession().setGlobalKey(&quot;myVendorId.myB2Handle.myKey&quot;, &quot;myValue&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Non-String values need to be serialized to save on the **BbSession** -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refactor to avoid if at all possible.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Java 11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Blackboard Learn SaaS runs on Java 11, as of Learn 3800. As a result, Building Block that are to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">be installed in the cloud, or on 9.1 Q2 2020 or later, need to be built with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Java 11. For more information see [8 steps to prepare for Java 11](/anthologydevdocs/docs/archive/b2/resources/archive-b2-resources-prepare_for_java_11).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Tomcat 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tomcat 8 introduces a few new complexities to the Building Block development</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process. This move was an opportunity to re-imagine how the Learn application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">startup performance could be improved. This work has been extremely</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">successful, but requires some refactoring of your code.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### JSP Precompilation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">It is expected that going forward, all Building Blocks will precompile JSPs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This simple step will assure that your JSP files render properly in Blackboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Learn. All bundled Building Blocks are required to take this step, while</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currently optional, this could become mandatory in the future.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This blog post describes one way to [precompile you Java Server Pages](https://community/blackboard.com/blogs/4/25){: target:\_blank} when using Gradle.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### bb-context-config.properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tomcat 8.5 is substantially more configurable in the way that you can</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">implement [jar scanning](https://tomcat.apache.org/tomcat-8.5-doc/config/jar-scanner.html){: target:\_blank}. This file lives in the WEB-INF directory of your Building Block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and provides the following options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### com.blackboard.tomcat.servletcontainer.jarscanner.tldJars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Because you should be precompiling your JSP files, this will normally be left</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blank. If on-demand JSP compilation is used, this may be set to a Java regular</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expression of jar file names. You should only include the jar files containing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">the TLD files needed by the non-compiled JSP files. The patter can include the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">template variable _@CORE_TLD_PATTERN@_, which will resolve to a regular</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expression matching all Blackboard jar files containing TLDs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Here are a few examples:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **RECOMMENDED**: Building Block uses several Blackboard Tag Libraries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.jarscanner.tldJars=@CORE_TLD_PATTERN@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.jarscanner.tldJars=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Building Block uses Struts and the bbNG Tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.jarscanner.tldJars=bb-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taglibs.jar|struts-taglib-.*\\.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Building Block uses several Blackboard libraries and Struts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.jarscanner.tldJars=@CORE_TLD_PATTERN@|s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">truts-taglib-.*\\.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### com.blackboard.tomcat.servletcontainer.jarscanner.pluggabilityJars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set this to a Java regular expression of jar file names that contain web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fragments, ServletContainerInitializers (SCIs), and other classes with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">annotations defined in the Servlet 3.1 specifications if they are used by the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Building Block.The pattern can contain the template variable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_@CORE_PLUGGABILITY_PATTERN@_, which will resolve to a regular expression that</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">matches all Blackboard jar files containing such components.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Here is an example:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- A Building Block contains classes that implement Spring&#x27;s WebApplicationInitializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.jarscanner.pluggabilityJars=spring-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">web-.*\\.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### com.blackboard.tomcat.servletcontainer.context.containerSciFilter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This Java regular expression should list all SCIs in the CLASSPATH that are</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**not** used by the Building Block. The default value is **^.\*$**, which</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">matches ALL SCIs and assumes that the Building Block does not use any.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Examples:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Building Block does not use SCIs and does not have any uncompiled jsps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.context.containerSciFilter=^.*$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- If for some reason, your JSP is not compiled, use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.context.containerSciFilter=^.*(?&lt;!\\.JasperInitializer)$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- If the JSPs are compiled, but your code relies on classes that implement Spring&#x27;s WebAppplicationInitializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.context.containerSciFilter=^.*(?&lt;!\\.SpringServletContainerInitializer)$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### com.blackboard.tomcat.servletcontainer.context.processTldsOnStartup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is not required to be in the bb-context-config.properties file. You would</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include this and set it to true only if the Building Block or one of the jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">files it contains defines a listener in a TLD that the Building Block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">requires.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.context.processTldsOnStartup=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Here is a final example of a typical /WEB-INF/bb-context-config.properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.jarscanner.tldJars=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.jarscanner.pluggabilityJars=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.context.containerSciFilter=^.*$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If you see errors like:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unable to compile &lt;myclass&gt; root cause:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO | jvm 1 | 2018/02/06 00:51:17 | java.lang.NullPointerException</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO | jvm 1 | 2018/02/06 00:51:17 | at org.apache.jasper.JspCompilationContex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t.getTldResourcePath(JspCompilationContext.java:566)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO | jvm 1 | 2018/02/06 00:51:17 | at</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.apache.jasper.compiler.Parser.parseTaglibDirective</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try adding making your bb-config-context.properties file look like this:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.jarscanner.tldJars=@CORE_TLD_PATTERN@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.jarscanner.pluggabilityJars=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.blackboard.tomcat.servletcontainer.context.containerSciFilter=^.*(?&lt;!\\.JasperInitializer)$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## web.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your Building Block should be using Web App version 3.0, and requires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata-complete to be set. By default and in most cases, this should be set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">to **true** for best performance. Set this to **false** ONLY if your Building</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Block uses annotation-based web_xml extensions as defined in the Servlet 3.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">specification or if your jar files should be scanned for web-fragment.xml.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">These are some of the annotations that require the metadata-complete attribute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">to be set to false:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- WebServlet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- WebFilter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- WebInitParam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- WebListener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- MultipartConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ServletSecurity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- HttpConstraint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- HttpMethodConstraint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- DeclareRoles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- EJB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- EJBs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- PersistenceContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- PersistentContexts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- PersistenceUnit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- PersistenceUnits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- PostConstruct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- PreDestroy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- RunAs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- WebServiceRef</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- WebServiceRefs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Some of these annotations, like PostContruct, PreDestroy, and Resource, only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require the setting to be false if they are placed in an object whose life-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cycle is managed by the container, such as a Servlet or a Listener.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Here is an example of what this will look like in your web.xml file:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;web-app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  xmlns=&quot;[http://java.sun.com/xml/ns/javaee](https://community.blackboa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rd.com/external-link.jspa?url=http%3A//java.sun.com/xml/ns/javaee)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app_3_0.xsd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version=&quot;3.0&quot; metadata-complete=&quot;true&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In addition to metadata-complete, another new tag should be included at the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end of the web.xml file: absolute-ordering. Generally, this should be an empty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tag for best performance. If web fragments are used, the ones that are</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">required should be listed explicitly her to to avoid unnecessary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">initialization of other unused fragments in the class path.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For example:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- The Building Block does NOT use web fragments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;absolute-ordering/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- The Building block uses web fragments from the spring-web jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;absolute-ordering&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;name&gt;spring_web&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/absolute-ordering&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Faster Startup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">When declaring servlets in web.xml, the &amp;lt;load-on-startup&amp;gt; tag allows you to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">decide when a servlet is loaded into memory. The default value is to load at</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">first access, but that is not always appropriate for every situation. The</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">following table illustrates the tags and their meanings. Be sure to select the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">one that is right for your Building Block.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Tag Value                                | Description                                                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| ---------------------------------------- | ---------------------------------------------------------------------- |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| &amp;lt;load-on-startup&amp;gt;1&amp;lt;/load-on-startup&amp;gt;     | Load the servlet during system initialization.                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| &amp;lt;load-on-startup&amp;gt;-1&amp;lt;/load-on-startup&amp;gt;    | Load the servlet the first time it is accessed.                        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| &amp;lt;load-on-startup&amp;gt;-9876&amp;lt;/load-on-startup&amp;gt; | Load the servlet immediately following the Learn system initialization |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Be sure to evaluate your individual integration before deferring your startup.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If this or another Building Block depends on the servlet code being registered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">or if this servlet must be live prior to the system starting for user access,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deferring startup is not appropriate.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deferring all of your servlets to load immediately following system startup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">will definitely make the system available to users more quickly, though one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">should note that those user requests might be a bit slower as all of the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">servlets are starting. In addition, it is important to note that should a user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">access a servlet that has been deferred and not yet started, it will load at</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">that time, so there is no risk of a servlet being unavailable should the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process still be underway.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If you are executing other startup logic inside something such as a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ServletContextListener&#x27;s contextInitialized method and that logic is not 100%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">required to be executed before user activity then please defer it by calling</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ContextInitThreadRunner.startThread(Thread) or .startDaemonThread(Thread).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Here is a snippet from the Javadoc explaining this method:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* This method can be used in place of thread.start() when you are starting a thread typically during system startup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* and you do not absolutely NEED that thread to start immediately. Once the system has completed normal startup of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* all webapps (b2s) and is ready to accept requests, any threads registered via this method will be started. &lt;br&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* &lt;br&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* It is safe to call this at any point in time though - if the server has already started then this will merely start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* the thread.&lt;br&gt;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* &lt;br&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* The reason we are doing this is to make sure all resources can be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dedicated to pure startup tasks and not diverted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* to &#x27;background&#x27; activity, thus getting the system to a ready state a bit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">faster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## URL Encoding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tomcat 8.5.12 and later releases of Tomcat 8.5.x by default does not allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curly braces ( { } ) or vertical bars, often referred to as pipes ( | ) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">URLs. For backward compatibility, [Tomcat provides a way to override this</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">behavior](https://tomcat.apache.org/tomcat-8.5-doc/config/systemprops.html) by allowing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a system property tomcat.util.http.parser.HttpParser.requestTargetAllow to be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">defined. Please be advised that this exposes the application to a [known</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">security issue](https://nvd.nist.gov/vuln/detail/CVE-2016-6816).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Future versions of Tomcat may not support this override. Therefore, all B2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">must url-encode these characters. For example, an URL like `http://myuniversity.blackboard.com/webapps/myb2/appController?options={x|y}` must be written by the application as `http://myuniversity.blackboard.com/webapps/myb2/appController?options=%7bx%7cy%7d`. Otherwise, Tomcat will reject the request.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Permissions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">As Blackboard continues to modernize the Blackboard Learn platform and move</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">services out of the Learn code line and into microservices, the need to secure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">the application from both accidental and malicious actions, the properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">granted to Building Block integrations is necessarily tightening. This is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">being addressed in a phased manner, with the intent of providing third-party</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">developers ample runway for adjusting to the new restrictions. As new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">restrictions are added, this page will list them, so be sure you are following</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">this page to receive updates.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Permission                   | Mitigating Factors                                          | Current Action\*\* |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| ---------------------------- | ----------------------------------------------------------- | ------------------ |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| java.security.AllPermission  |                                                             | Filtered Out       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| java.lang.RuntimePermission  | createSecurityManager, setSecurityManager                   | Filtered Out       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| java.lang.RuntimePermission  | action implying createSecurityManager or setSecurityManager | Warning Message    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| java.util.PropertyPermission | write                                                       | Warning Message    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| java.io.FilePermission       | ALL FILES                                                   | Warning Message    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Many Building Blocks rely on the ALL FILES permission for writing to the file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">system. This will be filtered out soon. The Building Block should request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">explicit file system permissions and utilize the advice in this guide when</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">writing to log files and config directories. To illustrate the change, here is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">an example of a bad permission and a good permission for writing to a log file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from a Building Block.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### BAD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;permission type=&quot;java.io.FilePermission&quot;name=&quot;&amp;lt;&amp;lt;ALLFILES&amp;gt;&amp;gt;&quot; actions=&quot;read,write,delete,wxecute&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### GOOD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">( A couple examples. See [ALL FILES No More](https://community.blackboard.com/blogs/4/26){: target=&#x27;\_blank&#x27;} for a full set.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;permission type=&quot;java.io.FilePermission&quot; name=&quot;BB_HOME/-&quot; actions=&quot;read,write,delete&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;permission type=&quot;java.io.FilePermission&quot; name=&quot;BB_HOME/logs/&quot; actions=&quot;read,write,delete&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Original UI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Original courses run in an iframe on Learn SaaS. This shouldn’t affect your</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Building Block, except in the two following cases:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- If you set **top.document.location** or **top.location.href** or any other similar settings that change the top page for the browser, your Building Block will not display properly. You can use **window.location** instead.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- HTML form tags with **target=&quot;\_top&quot;**, or **target=&quot;\_blank&quot;** will break out of the Ultra Original course peek panel. Change these to **target=&quot;\_self&quot;**.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- To meet accepted best practices in web design, there is a new maximum browser width of **1920px**. Make sure you plan accordingly.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- B2s using the bbUI and bbData tag libraries should be refactored were at all possible to use bbNG.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Ultra UI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">There are currently no extension points for Building Blocks in the Ultra UI.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Continuous Delivery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Blackboard strives to deliver updates every two weeks. As a result, you should</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">be using only public APIs whenever possible, as the continuous delivery model,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">coupled with the possibility of undocumented private API changes without</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">warning, makes using private APIs extremely risky.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Installing Building Blocks in Learn SaaS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">There is no way to install a Building Block in Learn SaaS, regardless of the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Interface you are using. If you have licensed Learn SaaS Plus or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Advantage, you do have the ability to install Building Blocks, but you must</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">work with support to schedule the installation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Update a Building Block for TinyMCE 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In Learn 3900.X we intend to implement an updated content editor, TinyMCE 5, in the Original Course View and Original Experience of Learn. (\*Forward-looking statement applies.) This editor changes certain patterns of UI with more of them living in an overlay modal rather than pop-up window after pop-up window. This change has led to required changes that are specific to B2s that have a Mashup. Cancel buttons in these mashups that expect to close a window will actually now need to close on overlay modal. The overlay modal will also include a close action button, an “x” in the interface, which will also work to close the window in case the cancel button doesn’t work; but if a cancel button in a mashup B2 is going to continue to work, the code will need to be updated.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The code below needs to be added for the cancel button. This code assumes that a B2 is being designed that is compatible with both the new editor and the older one, Learn v 3900.x vs v3800.x and earlier.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ( parent &amp;&amp; parent.tinymce &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     parent.tinymce.activeEditor &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     parent.tinymce.activeEditor.windowManager )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  parent.tinymce.activeEditor.windowManager.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Call the JavaScript you currently use for Cancel here.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If the B2 will only be compatible with the updated editor and not backwards compatible, the else section isn’t required:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ( parent &amp;&amp; parent.tinymce &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     parent.tinymce.activeEditor &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     parent.tinymce.activeEditor.windowManager )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  parent.tinymce.activeEditor.windowManager.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\*Statements regarding our product development initiatives, including new products and future product upgrades, updates or enhancements represent our current intentions, but may be modified, delayed or abandoned without prior notice and there is no assurance that such offering, upgrades, updates or functionality will become available unless and until they have been made generally available to our customers.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## B2 Changes Required for SameSite Issues with B2 Mashups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Why These Changes Are Necessary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">As of mid/late April 2021 Google Chrome 90 does not consider a GET request &quot;safe&quot; and blocks different site cookies even for a GET request. If an external server used GET with parameters to send data to a Learn server, that will no longer work because the session cookies are blocked. Hence, if your B2 provides a mashup that can be used in an Original course, you must implement a solution similar to the following. You can no longer use a GET as a workaround for SameSite issues. Or, you can migrate users to an LTI solution. The next paragraph gives more background.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Historically a Building Block can launch from content created by a Blackboard Learn B2 to a remote server where some content is selected to push back to Blackboard Learn. With the advent of browsers now enforcing a SameSite cookie policy the remote server cannot then make a request back to Learn with the cookies necessary for that Learn session due to stringent browser SameSite enforcement. For this discussion we’ll describe how that impacts a B2 mashup and describe a solution that uses JavaScript to get around the browser’s enforcement of the SameSite policy. You will need to examine the rest of your B2 functionality to determine if you need to make similar changes in other areas that get content from your server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Overview of the Changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">As an example, we will discuss a B2 that provides a mashup that does a launch to get content from a mashup content provider, say mashupsource.com. The user used to be able to select content on mashupsource.com which then did a form POST, or a GET back to the B2 endpoint. Because browsers now enforce the SameSite policy by default,the form POST will no longer work. Some browsers recently have also become more stringent with 3rd-party cookies and GET requests. The browser will not send the Learn Server (LearnServerFQDN) cookies to LearnServerFQDN when the cookies are on a request from any source other than the domain of the LearnServer, instead it blocks them.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hence you need a way update Learn Server content without a cross-site HTTP request from mashupsource.com to the Learn Server. The following describes how you can do this.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Instead of redirecting the browser to a page on mashupsource.com, that page needs to load an iframe, provided by your B2, with the source being mashupsource.com. The user will interact with mashupsource.com within that iframe and when done, that page will use JavaScript to postMessage to the parent window with whatever the result of the user’s interaction with mashupsource.com is. JavaScript in the parent (authored by mashupsource developers, rendered by your B2 as part of your mashup) will accept that message (after validating it is coming from mashupsource.com) and then from within this window (the one launched from LearnServerFQDN/B2…) it will then POST (or GET) back to the Learn B2 endpoint. Since this is a POST (or GET) from a page coming from the same origin it will work. These changes are compatible with the current and future releases of Blackboard Learn.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Here&#x27;s a diagram showing the message chain from a mashupsource.com to the B2 on the Learn server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[window/iframe: LearnServerFQDN – the Learn Original Course page with the editor on it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [iframe:LearnServerFQDN/B2 providing mashup (receive postMessage then POST or GET to appropriate B2 endpoint)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                [iframe src=mashupsource.com (postMessage to parent)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Note the brackets are indicating how the iframes are nested.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Summary - If your B2 provides a mashup for use in an Original Course&#x27;s TinyMCE editor you will need to re-architect as described above, or mirgrate users to an LTI-based solution.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#apis" class="table-of-contents__link toc-highlight">APIs</a></li><li><a href="#database" class="table-of-contents__link toc-highlight">Database</a></li><li><a href="#shared-content-folder" class="table-of-contents__link toc-highlight">Shared Content Folder</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/anthologydevdocs/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/anthologydevdocs/docs/REST APIs/apis-intro">REST APIs</a></li><li class="footer__item"><a class="footer__link-item" href="/anthologydevdocs/docs/LTI/lti-intro">LTI</a></li><li class="footer__item"><a class="footer__link-item" href="/anthologydevdocs/docs/Standards/standards-intro">Standards</a></li><li class="footer__item"><a class="footer__link-item" href="/anthologydevdocs/docs/Developer Portal/devportal-intro">Developer Portal</a></li><li class="footer__item"><a class="footer__link-item" href="/anthologydevdocs/docs/Partners/partners-become_a_partner">Partners</a></li><li class="footer__item"><a class="footer__link-item" href="/anthologydevdocs/docs/Community/community-intro">Community</a></li><li class="footer__item"><a class="footer__link-item" href="/anthologydevdocs/Blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/blackboardtechies/shared_invite/zt-nheykjth-wLgONrE58MS53H~oySYk1g" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack - Blackboard Techies<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="mailto:developers@anthology.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Anthology Developer Support<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More...</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://aws.amazon.com/marketplace/seller-profile?id=f6f7de05-e6d2-47f8-96e8-51cc4b38182b" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer AMI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/blackboard/anthologydevdocs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub - These docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/search?q=org%3Ablackboard+blackboard%2FBBDN-" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub - Example projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Anthology, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/anthologydevdocs/assets/js/runtime~main.86a85da2.js"></script>
<script src="/anthologydevdocs/assets/js/main.8f957423.js"></script>
</body>
</html>